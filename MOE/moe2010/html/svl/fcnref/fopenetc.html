<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!--
!!    MOE 2010.10 On-Line Manuals
!!    COPYRIGHT (C) 2010
!!        CHEMICAL COMPUTING GROUP INC.  ALL RIGHTS RESERVED.
!!-->

<!--	fopenetc.html	file open/close
!!
!!	24-feb-2009 (ms) fnametemp
!!	07-oct-2008 (ms) updated
!!-->

<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" type="text/css"
href="../../manstyle.css" />


<meta keywords>
<meta functions fopen>
<meta functions fopenr>
<meta functions fopenc>
<meta functions fopenw>
<meta functions fopenx>
<meta functions fopent>
<meta functions fopenct>
<meta functions fopentemp>
<meta functions fnametemp>

<meta functions _fopen>
<meta functions _fopenr>
<meta functions _fopenc>
<meta functions _fopenw>
<meta functions _fopenx>
<meta functions _fopent>
<meta functions _fopenct>
<meta functions _fopentemp>
<meta functions _fnametemp>

<meta functions fclose>
<meta functions fflush>

<meta functions fdelmark>
<meta functions fsetdelmark>


<title>File Functions</title>
</head>

<body  bgcolor="#ffffff">
<a href="../../index.htm"><img src="../../images/logo.gif"
alt="CCG Logo" align="right" width="174" height="55" border="0" /></a>
<h4>MOE 2010.10</h4>
<h2>File Functions</h2>
<hr noshade="noshade" />

<h2>Syntax</h2>

<pre>
    fnum = <a class="fcnlink" href="#fopen">fopen</a> 'filename'
    fnum = <a class="fcnlink" href="#fopen">fopen</a> fnum
    fnum = <a class="fcnlink" href="#_fopen">_fopen</a> 'filename'
    fnum = <a class="fcnlink" href="#_fopen">_fopen</a> fnum

    fnum = <a class="fcnlink" href="#fopenr">fopenr</a> 'filename'
    fnum = <a class="fcnlink" href="#fopenr">fopenr</a> fnum
    fnum = <a class="fcnlink" href="#_fopenr">_fopenr</a> 'filename'
    fnum = <a class="fcnlink" href="#_fopenr">_fopenr</a> fnum

    fnum = <a class="fcnlink" href="#fopenw">fopenw</a> 'filename'
    fnum = <a class="fcnlink" href="#fopenw">fopenw</a> fnum
    fnum = <a class="fcnlink" href="#_fopenw">_fopenw</a> 'filename'
    fnum = <a class="fcnlink" href="#_fopenw">_fopenw</a> fnum

    fnum = <a class="fcnlink" href="#fopenx">fopenx</a> 'filename'
    fnum = <a class="fcnlink" href="#fopenx">fopenx</a> fnum
    fnum = <a class="fcnlink" href="#_fopenx">_fopenx</a> 'filename'
    fnum = <a class="fcnlink" href="#_fopenx">_fopenx</a> fnum

    fnum = <a class="fcnlink" href="#fopenc">fopenc</a> 'filename'
    fnum = <a class="fcnlink" href="#fopenc">fopenc</a> fnum
    fnum = <a class="fcnlink" href="#_fopenc">_fopenc</a> 'filename'
    fnum = <a class="fcnlink" href="#_fopenc">_fopenc</a> fnum

    fnum = <a class="fcnlink" href="#fopenct">fopenct</a> 'filename'
    fnum = <a class="fcnlink" href="#fopenct">fopenct</a> fnum
    fnum = <a class="fcnlink" href="#_fopenct">_fopenct</a> 'filename'
    fnum = <a class="fcnlink" href="#_fopenct">_fopenct</a> fnum

    fnum = <a class="fcnlink" href="#fopent">fopent</a> 'filename'
    fnum = <a class="fcnlink" href="#fopent">fopent</a> fnum
    fnum = <a class="fcnlink" href="#_fopent">_fopent</a> 'filename'
    fnum = <a class="fcnlink" href="#_fopent">_fopent</a> fnum

    fnum = <a class="fcnlink" href="#fopentemp">fopentemp</a> []
    fnum = <a class="fcnlink" href="#fopentemp">fopentemp</a> 'pathprefix'
    fnum = <a class="fcnlink" href="#_fopentemp">_fopentemp</a> []
    fnum = <a class="fcnlink" href="#_fopentemp">_fopentemp</a> 'pathprefix'

    filename = <a class="fcnlink" href="#fnametemp">fnametemp</a> []
    filename = <a class="fcnlink" href="#fnametemp">fnametemp</a> 'pathprefix'
    filename = <a class="fcnlink" href="#_fnametemp">_fnametemp</a> []
    filename = <a class="fcnlink" href="#_fnametemp">_fnametemp</a> 'pathprefix'

    <a class="fcnlink" href="#fclose">fclose</a> fnum

    <a class="fcnlink" href="#fflush">fflush</a> file_handle

    flag = <a class="fcnlink" href="#fdelmark">fdelmark</a> file_handle
    <a class="fcnlink" href="#fsetdelmark">fsetdelmark</a> [file_handle, flag]
</pre>


<p><a name="fopen"></a></p>
<p><a name="_fopen"></a></p>

<h2>Description</h2>

<pre>
fnum = <span class="fcndef">fopen</span> 'filename'
fnum = <span class="fcndef">fopen</span> fnum
fnum = _fopen 'filename'
fnum = _fopen fnum
</pre>

<p>Functions <tt>fopen*</tt> open a file and return a file handle,
which is used in subsequent file I/O operations as the file identifier.

Except for function <tt><span class="fcndef">fopentemp</span></tt>, all <tt>fopen*</tt> functions
expect either a filename or a file handle of an already opened file
as their argument.  The name of the file, <tt>'filename'</tt>,
must be a token.  The file handle, <tt>fnum</tt>, is a number.
</p>

<p>
Given a filename, the functions examine whether the file already
exists and is writeable, and offer different behavior
depending on those properties.

When the requested file fails to open, the <tt>fopen*</tt> functions
exit with an error.  However, when their names are prefixed with
an underscore, the functions will not exit, returning 0 instead.
Any code that uses underscored functions must detect and process their
possible failures explicitly.
</p>

<p>
Each file handle returned by an <tt>fopen*</tt> function must be
closed, in the same SVL task, by function <tt><span class="fcndef">fclose</span></tt>.

When passed a file handle, the functions increase the "reference count"
(a record of the number of times the file has been opened)
of the file, ensuring that the file remains open for the accessing
task until a corresponding <tt><span class="fcndef">fclose</span></tt> has been called.
</p>

<!-- DESC -->

<p>
<table border=1 width=100% cellpadding=5 cellspacing=0>

<tr>
<td valign="baseline"><tt><span class="fcndef">fopen</span></tt></td>
<td valign="baseline">
Opens an existing file for reading and writing.  If the file is does
not exist or is not writeable, the function exits with an error.
</td></tr>

<tr>
<td valign="baseline">
<a name="fopenr"></a><tt><span class="fcndef">fopenr</span></tt></td>
<td valign="baseline">
Opens an existing file for reading only.  If the file is does
not exist, the function exits with an error.
</td></tr>

<tr>
<td valign="baseline">
<a name="fopenw"></a><tt><span class="fcndef">fopenw</span></tt></td>
<td valign="baseline">
Opens a file for reading and writing.
If the file does not exist, the function creates it.
If the file exists and is writeable, the functions truncates its contents. 
If the file is not writeable, the function exits with an error.
</td></tr>

<tr>
<td valign="baseline">
<a name="fopenx"></a><tt><span class="fcndef">fopenx</span></tt></td>
<td valign="baseline">
Opens a file for reading and writing.
If the file does not exist, the function creates it.
If the file exists and is writeable, the functions opens it without
truncating it.
If the file is not writeable, the function exits with an error.
</td></tr>

<tr>
<td valign="baseline">
<a name="fopenc"></a><tt><span class="fcndef">fopenc</span></tt></td>
<td valign="baseline">
Opens a new file for reading and writing.
If the file does not exist, the function creates it.
If the file exists, the function exits with an error.
</td></tr>

<tr>
<td valign="baseline">
<a name="fopenct"></a><tt><span class="fcndef">fopenct</span></tt></td>
<td valign="baseline">
Opens a temporary new file for reading and writing.
If the file does not exist, the function creates it.
If the file exists, the function exits with an error.
When the file handle is closed, the file deletion marker
(&quot;<a href="#delmark">delmark</a>&quot;) is set, and
the file automatically deleted when the file's
"reference count" falls to zero.
</td></tr>

<tr>
<td valign="baseline">
<a name="fopent"></a><tt><span class="fcndef">fopent</span></tt></td>
<td valign="baseline">
Opens a temporary file for reading and writing.
If the file does not exist, the function creates it.
If the file exists and is writeable, the functions opens it without
truncating it.
If the file is not writeable, the function exits with an error.
When the file handle is closed, the file deletion marker
(&quot;<a href="#delmark">delmark</a>&quot;) is set, and
the file automatically deleted when the file's
"reference count" falls to zero.
</td></tr>

<tr>
<td valign="baseline">
<a name="_fopenr"></a>
<a name="_fopenc"></a>
<a name="_fopenw"></a>
<a name="_fopenx"></a>
<a name="_fopent"></a>
<a name="_fopenct"></a>
<tt><span class="fcndef">_fopen</span></tt><br />
<tt><span class="fcndef">_fopenr</span></tt><br />
<tt><span class="fcndef">_fopenw</span></tt><br />
<tt><span class="fcndef">_fopenx</span></tt><br />
<tt><span class="fcndef">_fopenc</span></tt><br />
<tt><span class="fcndef">_fopenct</span></tt><br />
<tt><span class="fcndef">_fopent</span></tt>
</td>
<td valign="baseline">
Identical to the above functions except when the file fails to open:
instead of exiting with an error, the underscore functions return 0.
Any code that uses underscore functions must detect and process their
possible failures explicitly.
</td></tr>

</table>

<!-- ENDDESC -->


<!--
<pre>
filenum = <span class="fcndef">fopen</span>  'filename'
filenum = <span class="fcndef">fopenr</span> 'filename'
filenum = <span class="fcndef">fopenw</span> 'filename'
filenum = <span class="fcndef">fopenx</span> 'filename'
filenum = <span class="fcndef">fopenc</span> 'filename'
filenum = <span class="fcndef">fopenct</span> 'filename'
filenum = <span class="fcndef">fopent</span> 'filename'
</pre>

<p>Open a file and return a file handle.  The file handle <tt>filenum</tt> is
used in subsequent file I/O as the file identifier.  The name of the file is
supplied as a token.

<p><tt>fopenr</tt> opens a file for reading only.  <tt>fopen</tt> and
<tt>fopenw</tt> both open a file for both reading and writing, however,
<tt>fopen</tt> assumes that the file already exists (it is an error if it does
not), whereas <tt>fopenw</tt> will either create it if it does not, or will
overwrite it if it does.

<p><b>Caution!</b> <tt>fopenw</tt> will destroy all original contents of
an already-existent file.

<p><tt>fopent</tt> opens a temporary file for writing.  A file with the given
<tt>filename</tt> will be opened for reading and writing and will exist as long
as the file is being referenced.  The file is removed from disk when it is
closed.

-->

<p>Explicit reading from and writing to standard devices is accomplished using
the special standard file identifiers <tt>'*cli*'</tt>, <tt>'*stdin*'</tt>,
<tt>'*stdout*'</tt>, and <tt>'*stderr*'</tt>. These devices do not have to be
opened explicitly. Their handles are predefined constants:

<tt>CLI</tt>, <tt>STDIN</tt>, <tt>STDOUT</tt>, <tt>STDERR</tt>.

The <tt>STDIN</tt> must be opened with <tt>fopenr</tt>.
The <tt>CLI</tt>, <tt>STDOUT</tt> and <tt>STDERR</tt> must be opened
with <tt>fopenw</tt>.

<p><b>Example:</b> The following function will read and return (up to)
10 lines of the file indicated by the function argument.  If the argument
is a filename, the function will open the file and read the first 10 lines.
If the argument is a file handle of an open file, the function will
read the next 10 lines.

<pre>
local function read_ten_lines file
    local s, i, lines = [];

    local fnum = fopenr file
    for i = 1, 10
    while length (s = freadb [fnum, 'line', 1]) loop
	lines(i) = cat s;
    endloop
    fclose fnum;

    return lines;
endfunction
</pre>

<p><b>Note:</b> File handles opened with <tt>fopenr</tt> are read-only and
cannot be reopened for writing with <tt>fopen</tt> or other
<tt>fopen*</tt> functions.

<p><b>Warning:</b> Often, function <tt>task_call</tt> is used to guard
against possible errors.  However, the following code will <i>not</i> work:

<pre>
    [fnum, tcode] = task_call ['fopen', filename, [errmsg:'ignore']];
    if tcode == '' then
	... use fnum ...
    else
	... there was an error ...
    endif
</pre>

This is because file handles <i>must</i> be opened by the SVL task that use
them.  In the code above, a new, separate task is created to call function
<tt>fopen</tt>.  When the call is complete, that task terminates, and
the file that was opened is automatically closed.  If the calling task
tries to use the returned file handle, it will discover that the
file handle is no longer valid and exit with an error.

To check for errors, the following code should be used instead:

<pre>
    fnum = _fopen filename;
    if not fnum then
	... there was an error ...
    endif
</pre>

<p><a name="_fopentemp"></a></p>
<p><a name="fopentemp"></a></p>
<p><hr noshade="noshade" />

<pre>
filenum = <span class="fcndef">fopentemp</span> []
filenum = <span class="fcndef">fopentemp</span> 'pathprefix'
filenum = <span class="fcndef">_fopentemp</span> []
filenum = <span class="fcndef">_fopentemp</span> 'pathprefix'
</pre>

<p>Open a file for writing and return a temporary file handle.  The file handle
<tt>filenum</tt> is used in subsequent file I/O as the file identifier.
</p>

<p>The temporary file will be automatically named by the system and will be
opened in the <tt>TMP</tt> directory if no argument is provided.  If a
<tt>pathprefix</tt> token is provided then it will be used as a prefix for the
temporary filename and automatically extended with a suffix to ensure a unique
filename.  When the file is closed and no longer referenced the file and its
contents will be removed from the system.
</p>

<p>The underscored version of the function will not exit with an error
when the given path prefix is not accessible or the temporary file
fails to create.  Instead, the function will return 0.
</p>

<p>The 'pathprefix' argument may contain a <tt>*</tt> (star) wildcard.
If the wildcard is present in the function argument,
the temporary filename is not
automatically extended with a suffix.
Instead, the function creates a unique
name for the temporary file by replacing the wildcard with a string of
random digits.
</p>

<p>
There may be only one wildcard character in the prefix.  The wildcard
must not be in the "directory" portion of the prefix, i.e. it must
not be followed by any <tt>/</tt> characters.
</p>

<p><b>Example:</b> The following are valid prefixes:

<pre>
    fopentemp ''
    fopentemp '/home/joe/job3'
    fopentemp '/home/joe/job3_*.png'
</pre>

<p>The following are invalid prefixes:

<pre>
    fopentemp '/home/joe/job*/data'
    fopentemp '/home/joe/job*_data*.png'
</pre>

<p><b>Note:</b> The difference between <tt>fopent</tt> and <tt>fopentemp</tt>
is that <tt>fopentemp</tt> always creates a new filename, while <tt>fopent</tt>
does not.  The function <tt>fopent</tt> accepts a filename or a file handle as
its argument.  The function <tt>fopentemp</tt> accepts neither; instead, it
accepts only an optional path <i>prefix</i> which restricts the form
of the filename that the function may create.
Function <tt>fopent</tt> will open and delete exiting files (or may fail on
read-only files).  Function <tt>fopentemp</tt> will not open or delete
exiting files.
</p>

<p><a name="_fnametemp"></a></p>
<p><a name="fnametemp"></a></p>
<p><hr noshade="noshade" />

<pre>
filename = <span class="fcndef">fnametemp</span> []
filename = <span class="fcndef">fnametemp</span> 'pathprefix'
filename = <span class="fcndef">_fnametemp</span> []
filename = <span class="fcndef">_fnametemp</span> 'pathprefix'
</pre>

<p>Return the name of the file that would be generated by function
<tt>fopentemp</tt> (or <tt>_fopentemp</tt>).  The functions ensure
that the returned filename does not refer to an existing file and
that a file of that name can be opened for writing.  (Note, however,
that while reliable in practice, this behavior cannot be absolutely
guaranteed in all situations.)
</p>

<p>The underscored version of the function will not exit with an error
when the given path prefix is not accessible or when the temporary file
fails to create.  Instead, the function will return <tt>''</tt>.
</p>

<p><a name="fclose"></a></p>
<p><hr noshade="noshade" />

<pre>
<span class="fcndef">fclose</span> filenum
</pre>

<p>Close a file. <tt>filenum</tt> is the file handle returned by any of the
file open functions.  The function accepts (and ignores) invalid file handles.

<p><a name="fflush"></a></p>
<p><hr noshade="noshade" />

<pre>
<span class="fcndef">fflush</span> file_handle
</pre>

<p>Immediately flushes the buffer of the file specified by
<tt>file_handle</tt>. The buffer of a file is flushed automatically when it
accumulates enough data, or when the file is closed.

<p><a name="delmark"></a>
<p><a name="fsetdelmark"></a></p>
<p><a name="fdelmark"></a></p>
<p><hr noshade="noshade" />

<pre>
flag = <span class="fcndef">fdelmark</span> file_handle
<span class="fcndef">fsetdelmark</span> [file_handle, flag]
</pre>

<p>Each open file may be marked for automatic deletion after its
handle is closed.  Function <tt>fdelmark</tt> returns 1 if the file
has been marked for deletion and 0 otherwise.  Function <tt>fsetdelmark</tt>
sets the deletion marker for a given file.  By default, file handles opened
with <tt>fopent</tt>, <tt>fopenct</tt> and <tt>fopentemp</tt> are
marked for deletion, while file handles opened with the remaining
<tt>fopen*</tt> functions are not.

<h2>See Also</h2>


<table>
<tr>
<td colspan="3"><a href="constants.html">SVL Built-In Constants</a><br />
</tr>
<tr>
<td valign="top">
<a class="svl" href="flistetc.html">fdelete</a><br />
<a class="svl" href="flistetc.html">flist</a><br />
<a class="svl" href="freadetc.html">fread</a><br />
<a class="svl" href="freadb.html">freadb</a><br />
<a class="svl" href="flistetc.html">fseek</a>
</td>

<td valign="top">
<a class="svl" href="flistetc.html">fsize</a><br />
<a class="svl" href="flistetc.html">ftell</a><br />
<a class="svl" href="flistetc.html">ftype</a><br />
<a class="svl" href="freadetc.html">fwrite</a><br />
<a class="svl" href="freadb.html">fwriteb</a>
</td>
</tr>

</table>


<p><a href="../../index.htm">MOE Table of Contents</a>&nbsp;&nbsp;<a href="../../fcnindex.html">SVL Function Index</a></p>
<hr noshade="noshade" />
<a href="http://www.chemcomp.com"><img src="../../images/flogo.gif"
alt="CCG Logo"
align="left" width="30" height="30" border="1" hspace="5" vspace="3" /></a>
<font size="2">
<a href="../../legal.html">Copyright</a> &copy; 1997-2010
<a href="http://www.chemcomp.com">Chemical Computing Group Inc.</a><br />
<a href="mailto:info@chemcomp.com"><i>info@chemcomp.com</i></a>
</font>
</body>
</html>
