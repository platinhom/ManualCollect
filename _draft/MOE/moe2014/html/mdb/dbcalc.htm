<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">


<!--
!!    MOE Online Manuals
!!    COPYRIGHT (C) 1997-2015
!!        CHEMICAL COMPUTING GROUP INC.  ALL RIGHTS RESERVED.
!!-->

<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<script type="text/javascript" 
src="../include/jsincludes_moe.js"></script>

<link rel="stylesheet" type="text/css"
href="../include/manstyle.css" />


<meta panel Molecular Database Calculator>
<meta panel Database Calculator>

<title>Molecular Database Calculator</title>
</head>

<body>
<div id="MoeHeader"></div>
<noscript>
	<span class="warning">Warning: JavaScript is disabled. This page will not display correctly.</span>
	<h1 class="title">MOE Documentation</h1>
	<hr noshade="noshade" />
	<style>.LaTeX {color: #C08080;}</style>
</noscript>

<ul>
<li><a href="#Panel">Using the Molecular Database Calculator</a>
<li><a href="#CalculatorFunctions">Calculator Functions</a>
<li><a href="#UserFunctions">User Functions</a>
<li><a href="#Panel">Molecular Database Calculator Panel Reference</a>
<li><a href="#SVL">SVL Commands</a>
</ul>

<p>The Molecular Database Calculator is similar to
a standard hand-held calculator except that it also evaluates
equations using values from a
MOE molecular database.  Numeric fields can be included
in the equations allowing you to perform  
calculations on molecular databases in MOE. 
Furthermore, the capability to map a custom-designed function to
the USER button gives you the ability to implement your own calculations
and evaluate the function on multiple databases easily.


<h2> <a name="Panel">Using the Molecular Database Calculator</a> </h2>

<p>To use the Calculator, you first open the database on which you wish
to operate. A single calculator may be opened per database. The
Calculator command is grayed out if the database is read-only.

<p>Open a database in a Database Viewer and choose
<nobr><b>Compute | Calculator</b></nobr>.


<p>
<center>
<img src="dbcalc/dbcalc.png" alt="Molecular Database Calculator">
</center>

<p>Suppose you wish to create the following equation,
assuming you have a database with two numeric fields named 
<tt>chi1</tt> and <tt>chi2</tt>:

<center>
<p><img src="dbcalc/eqn.png">
</center>

<ol>

<p><li>To insert the first database field into the equation, double-click on
<tt>chi1</tt> in the list of available fields.

<p><li>Click on the + button. 

<p><li>Double-click on <tt>chi2</tt> in the Available Fields list.

    <p><b>Note:</b> If you make a mistake, you can either use the Del button
    on the Calculator to remove symbols, or edit the equation directly
    on the Equation display area.

<p><li>Ideally, the new field created in the database should be named
something that will remind you of how the values were calculated.  In this
case, we will replace the default name with the actual equation:

<center>
<p><img src="dbcalc/dest.png">
</center>

<p><li>To evaluate the equation, press the Evaluate
button. Evaluated results are written in the destination field of the database. 
The evaluation proceeds in an entry by entry manner.

<p>If no fields are included in the equation, the result will still be
written for each entry in the destination field. Suppose, for example, you
were to evaluate the expression <tt>log 99</tt>.
Each entry will still be evaluated (see table below). However, if the
destination field is left blank, the MOE Calculator outputs the result as
a single number at the Commands window.

<center>
<p><img src="dbcalc/log.png">
</center>

</ol>


<h2> <a name="CalculatorFunctions">Calculator Functions</a> </h2>

<p>The functions available in the calculator include the standard
numerical, logarithmic, trigonometric and logical functions as well as  
additional statistical functions.  Most functions operate on
each entry (row based), however, there are several
functions that operate on an entire column.

<center>
<p><img src="dbcalc/ccbuttons.1.png">
</center>

<p>The calculator function buttons can be divided into the following list of
categories:
<ul>
<li><a href="#Constants">Constants</a>
<li><a href="#RelationalOperators">Relational Operators</a>
<li><a href="#RowBasedFunctions">Row-based Functions</a>
<li><a href="#LogicalOperators">Logical Operators</a>
<li><a href="#Numbers">Numbers</a>
<li><a href="#ArithmeticOperators">Arithmetic Operators</a>
<li><a href="#ColumnBasedFunctions">Column-based Functions</a>
<li><a href="#EntryBasedFunctions">Entry-based Functions</a>
<li><a href="#Miscellaneous">Miscellaneous</a>
<li><a href="#UserFunctions">USER Functions</a>
</ul>


<h4> <a name="Constants">Constants</a> </h4>

These functions take no arguments and return a constant value.
The functions in this category are <tt>PI</tt> and <tt>e</tt>.


<h4> <a name="RelationalOperators">Relational Operators</a> </h4>

The relational operators are <, >, <=, >=, ==, &lt, &gt. 
These operators cannot be "chained" together. However, the use of parentheses 
solves this problem:

<pre>
    x < y < z	// invalid
    x < (y < z) // valid
</pre>


<h4> <a name="RowBasedFunctions">Row-based Functions</a> </h4>

Most of the calculator functions operate in a row-based manner, i.e.
the equation is evaluated entry by entry.

<center>
<p><img src="dbcalc/row.png">
</center>


<h4> <a name="LogicalOperators">Logical Operators</a> </h4>

The logical operators, <b>and</b> and <b>or</b>, perform row-based operations.
Unit extension will apply. 


<h4> <a name="Numbers">Numbers</a> </h4>

Numbers can be inserted into the equation using the number
pad or by typing them into the equation area directly. 


<h4> <a name="ArithmeticOperators">Arithmetic Operators</a> </h4>

The arithmetic operators are binary operators: they take
two arguments in infix notation.  The arguments may be fields, in
which case the operation is performed on an entry by entry basis.

For example,

<pre>
    1 + 2
</pre>

<p>evaluates to 3 and is inserted in each entry of the result field.

However, if we were to add two fields together:

<pre>
    {a_nC} + {a_nF}
</pre>

<p>the result is a new field with the value of the corresponding
entries under the fields a_nC and a_nF added together.


<p>If the field contains vector values, the operation is
only performed if the two vectors have the same number of
elements. Unit extension will be applied if possible.  If the 
vectors are of different length, and unit extension cannot be
applied, then the equation is not evaluated and the entry is
left blank.

<p>Consider the following:

<p><center>
<img src="dbcalc/calc2.png">
</center>

<p>In this example we have the following results:

<p><table cellpadding=5>
<tr>
<td><b>Entry</b></th>
<td><b>Result</b></th>

<tr>
<td valign=top>Row 1
<td valign=top>The 4 in B is unit extended to each element in A.

<tr>
<td valign=top>Row 2
<td valign=top>The vectors in A and B are of equal length so they are
added element wise.
    
<tr>
<td valign=top>Row 3
<td valign=top>The vectors in A and B are not of equal length and unit 
extension is not possible. No result is written.

<tr>
<td valign=top>Row 4
<td valign=top>There is no value in A so no result is calculated.

</table>


<h4> <a name="ColumnBasedFunctions">Column-based Functions</a> </h4>

This category of functions operate on an entire column of data.
The data must be scalars, vectors will be ignored in the calculations.
The column-based functions are grouped together in the Calculator:

<p><center>
<img src="dbcalc/colfcns.png">
</center>

<p>If a column-based function is part of an equation, this function
will be evaluated first and the result substituted into the
equation.

<p><ul>
<li><b>max</b>, <b>min</b>
    perform a lexicographic comparison on an entire column.
<li><b>mean</b> calculates the mean of a column.
<li><b>sum</b> calculates the sum of all values in a column.
<li><b>fquart</b>, <b>median</b>, <b>tquart</b> return the first
quartile, median and third quartile of a column.

<li><b>std_dev</b> calculates the standard deviation of a column.
</ul>

<p>
<center>
<img src="dbcalc/mean.png">
</center>


<h4> <a name="EntryBasedFunctions">Entry-based Functions</a> </h4> 

Entry-based functions take no arguments and return a value
based on the entry number itself.

<ul> 
<p><li><b>index</b> returns the entry number which the equation is currently
being applied to.

<p><li><b>selected</b> returns the selection state (0 or 1) of the entry in 
the database. If the database is not open in a Database
Viewer, the value of selected is 0 (non selected) for all entries.
</ul>


<h4> <a name="Miscellaneous">Miscellaneous</a> </h4>

<b>RAND</b> returns a real uniform random number ranging between 0 and 1
each time a new entry is processed by the Calculator.  RAND takes no
arguments.

<p>The <b>pow</b> operator is used in its infix form in the Calculator, as
opposed to its postfix form in SVL.

For example, at the SVL command line interface, one would type:

<pre>
    pow [2,3]
    8
</pre>
	
whereas, in the Calculator, the expression would be:

<pre>
    2 pow 3
</pre>
</ul>

</ol>


<h2> <a name="UserFunctions">USER Functions</a> </h2>

<p>A user function may be used within the database equations by
mapping a global function to the USER button.  This is done through
the text field:

<p>
<center>
<img src="dbcalc/user.png">
</center>

<p>The following conditions apply to USER functions:

<ul>
<li> The sole argument must be a numeric vector of any length.
<li> The function must return a numeric vector.
</ul>

You can define a user-specific function in the Molecular Calculator by
creating a global function and mapping it to the USER button.

<p> Say, for instance, that the current database includes a field called
Fahrenheit with temperatures in the Fahrenheit scale. You would like to
add a field with Celsius values as well. To do so, you need to convert
Fahrenheit to Celsius. You first create a global function, which for the
purposes of this example we have called <tt>FahrenheitToCelsius</tt>, as:

<pre>
    global function FahrenheitToCelsius v
	return (5/9)*(v-32);
    endfunction
</pre>

<p>Save and load the function, using the SVL Text Editor or otherwise.

<p>In the Molecular Calculator, press the USER button and double-click on
the Fahrenheit field to insert it into the equation.

  <p>The equation display area should
display:

<pre>
    USER {Fahrenheit}
</pre>

<p>In the USER Function field, enter the name of the function
<tt>FahrenheitToCelsius</tt>. In the Destination Field, enter the name
of the database field (e.g. Celsius) that will contain the
evaluated results.  Press Evaluate.


<h2> <a name="Panel">Molecular Database Calculator Panel Reference</a> </h2>

<p>The Molecular Database Calculator Panel includes the following options:

<p><table cellpadding="5" cellspacing="5">

<tr>
<td valign=top><b>Database</b> 
<td valign=top>Path and filename of the database on which calculations
will be performed. Results of the calculation are written to the database
as they are available, in the Destination Field.
</tr>

<tr>
<td valign=top><b>Use Selected Entries Only</b>
<td valign=top>If on, the calculation will only be performed on the
selected entries of the database.
</tr>


<tr>
<td valign=top><b>History Buttons</b>
<td valign=top>
<img src="dbcalc/history.png" alt="History Buttons in Molecular Database Calculator">

<p>Buttons used to browse through the equation history:

<ul>

<p><li>The &lt;&lt; button returns to the previous equation in the history
list, whereas the &gt;&gt; button moves forward in the history list. A maximum
of 25 successfully evaluated equations are kept in memory. 
Note that the equation history is lost when the Calculator is
closed.</li>


<p><li>&lt; removes the last symbol or field inserted in the equation. The
&gt; button retrieves it. These buttons
always apply to the last symbol in the equation.</li>


<p><li>Del removes the last symbol from the equation. </li>

</ul>
</tr>

<tr>
<td valign=top><b>Equation Display Area</b>
<td valign=top>Area in which the equation is displayed.
You can type the equation in the display area or use the function buttons.
When you press a button, the symbol is inserted at 
the end of the equation. 

<p>Field names can also be typed directly in the equation display area. 
They must be surrounded by {curly brackets}.

<p><img src="dbcalc/display.png" alt="Equation Display Area in Molecular Database Calculator">

</tr>

<tr>
<td valign=top><b>Available Fields</b>
<td valign=top>List of numeric fields available in the specified database.
Double-click on a field name in the list to insert it in the equation
display area. Field names are surrounded by {curly brackets} in the equation.

<p><img src="dbcalc/ccfield.png" alt="Available Fields in Molecular Database Calculator">
</tr>

<tr>
<td valign=top><b>Function Buttons</b>
<td valign=top>Operative buttons used to perform the 
<a href="#CalculatorFunctions">calculator functions</a>.
</tr>

<tr>
<td valign=top><b>USER Function</b>
<td valign=top><a href="#UserFunctions">User-defined function</a>, which can be used as a normal
operator on the database.
</tr>

<tr>
<td valign=top><b>Destination Field</b>
<td valign=top>Name of the database field to which evaluated results are
written. A default unique name is supplied. However, we suggest you give
the destination field a meaningful name, i.e. a name that will
give you some information on the equation used to calculate the values.
If no destination field is specified, the output is sent to the SVL
Commands window.  

<p>The Destination Field contains a shortcut list at the
right of the field.  This list holds the names of all numeric fields
in the database.

<p>
<img src="dbcalc/dest.png" alt="Destination Field in Molecular Database Calculator">

</tr>

<tr>
<td valign=top><b>Destination Type</b>
<td valign=top>Type of database field to create.  Only numeric types are
allowed.
<p><img src="dbcalc/types.png" alt="Destination Field Type">

</tr>

<tr>
<td valign=top><b>Evaluate</b>
<td valign=top>Evaluates the equation. Once you press Evaluate, the button changes
to Cancel, allowing you to stop the evaluation
process at any time. When the computation is finished, the button reverts
back to Evaluate.

<p>Results are written to the Destination Field
of the database. An
error message will appear if the equation contains syntax errors.

</tr>

<tr>
<td valign=top><b>Clear</b>
<td valign=top>Clears the equation display area.
</tr>

</table>


<h2> <a name="SVL">SVL Commands</a> </h2>

<a class="svl" href="../moe/fcnref/db_calc.htm#db_Calculator">db_Calculator</a>

<p>The database calculator can be run by entering: 
<pre>
    run '$MOE/lib/svl/run/dbcalc.svl'
</pre>

<p>Or by first loading the molecular database file and then running 
<tt>db_Calculator []</tt>.


<h2>See Also</h2>
<p>
<a href="db.htm">Molecular Database Viewer</a><br>


<noscript>
	<hr noshade="noshade" />
	<font size="2"> Copyright &copy; 1997&ndash;2015
	<a href="http://www.chemcomp.com">Chemical Computing Group Inc.</a> </font>
</noscript>
<div id="MoeFooter"></div>
</body>
</html>
