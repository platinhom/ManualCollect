<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!--
!!      molsup.htm      molecule superpose chapter
!!-->

<!--
!!    MOE Online Manuals
!!    COPYRIGHT (C) 1997-2015
!!        CHEMICAL COMPUTING GROUP INC.  ALL RIGHTS RESERVED.
!!-->

<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<script type="text/javascript" 
src="../include/jsincludes_moe.js"></script>

<link rel="stylesheet" type="text/css"
href="../include/manstyle.css" />


<meta panel Molecule Superpose>

<title>Molecule Superpose</title>
</head>

<body>
<div id="MoeHeader"></div>
<noscript>
        <span class="warning">Warning: JavaScript is disabled. This page will not display correctly.</span>
        <h1 class="title">MOE Documentation</h1>
        <hr noshade="noshade" />
        <style>.LaTeX {color: #C08080;}</style>
</noscript>

<h6 class="h-two">Contents</h6>
<div id="toc-list"><script>var gman_OrderedListTOC=false; </script></div>


<a name="Introduction"></a>
<h2>Introduction</h2>

The Molecule Superposition application is used to superpose a set of 3D
molecules contained in a database onto one or more reference structures (or
templates).
The resulting alignments are ranked by a scoring function similar to that of
<a href="flex.htm">FlexAlign</a> using both atom-centered and projected
feature terms along with the MSD of the superposition.  An additional
 protein/ligand clash term is added to this scoring function when used in 
<a href="docking.htm">Docking's</a>
<span class="nobr"><b>Template Forcing</b></span> or
<span class="nobr"><b>Template Similarity</b></span> placement methods.

<p>
The atom correspondences needed for superposition can be determined by a number
of query methods: (1) matching a subset defined by atom selection, SMARTS or
sketched queries, (2) an undirected heavy-atom and projected feature triplet
matching scheme or (3) matching conformers of the template structure(s).
The resulting aligned
structures can be used as input for MOE applications such as
<a href="ph4_query.htm#ConsensusMethod">Pharmacophore Consensus</a>,
<a href="ph4_query.htm">Pharmacophore Query Editor</a> or
<a href="breed.htm">BREED</a>.

<a name="Methodology"</a>
<h2>Methodology</h2>
The Molecular Superposition process starts with one or more user-specified
templates.  These can be complete molecules,
molecular fragments
or sets of disconnected fragments.  These define the coordinate system
for the aligned results and contain the atoms that will be used to superpose
structures.  As the similarity score uses all atoms of the
template input structures, those not involved in the actual
superposition will contribute towards ranking the results (via their
volume, heteroatomic substitution and pharmacophore patterns).

<p>
The <a href="../moe/fcnref/superpos.htm">Superpose</a> function requires
two or more sets of atomic coordinates to align structures, generated by
identifying the corresponding atoms in each structure.  It returns the
RMSD match of the resulting alignment.  Molecular
Superposition performs pairwise superpositions, using a fixed template
to which the input molecule is aligned.  The atom correspondence
can be determined by a number of query methods:

<h3>Selected Atoms</h3>
This method uses the selected atoms of the main MOE window to generate
search queries.  Note that selecting a portion of a molecule can
yield different atom types and/or bonds as compared to the complete
structure.
Each query is used to search the input structures
for those containing an exact match of the atoms and bonds of the
selected atoms of the template. Each match defines the
atom correspondence used to superpose the two molecules.  The results
are scored, duplicate checked, and kept if appropriate.

<h3>Substructure Search</h3>
<div class="floatright">
<img src="dbv_molsup/search1_crop.png" alt="Sample sketched query">
</div>

The <b>SMARTS</b> and <b>Sketch</b> query methods allow the user to define
the substructure via a user-defined query.  The
<a href="../moe/fcnref/smartsfcn.htm#Definition">SMARTS
language</a> provides a powerful, flexible means of searching chemical
structures.  For example, <tt>c1cccca1</tt> will match either phenyl or
pyridyl groups.   Alternatively, the user can enter a query via a
<span class="nobr">
<a href="../moe/extprog.htm#2DSketchers">2D sketcher</a></span>.
This is a more
familiar way of dealing with chemical structures.  The query to the right
will also match phenyl or pyridyl groups.
Both methods support atom and bond wildcards and other more complex search
query features.  

<p>
Using these methods, atom correspondences are generated by finding each
occurrence of the query in each template and matching these
to each occurrence of the query in the input structure. For example,
the SMARTS string, <tt>*1~*~*~*~*~*1</tt>, will find six-membered rings.
Given the following template and input structures:

<p><table border="0" align="center" cellpadding="5">
<tr>
<th><img src="dbv_molsup/ref1_crop2.png">&nbsp;</th>
<th>&nbsp;<img src="dbv_molsup/input1_crop2.png"></th>
</tr>
<tr>
<th>Reference</th>
<th>Input</th>
</tr>
</table>

two rings are found in the template and three in the input
structure (circled in <font color="red">red</font>).  This results in at
least 6 sets of matches, with each containing various atom correspondences.
Two alignments are shown below:

<p><table border="0" align="center" cellpadding="5">
<tr>
<th><img src="dbv_molsup/best1_crop2.png">&nbsp;</th>
<th>&nbsp;<img src="dbv_molsup/alt1_crop2.png"></th>
</tr>
<tr>
<th>Best Score</th>
<th>Alternate</th>
</tr>
</table>

As phenyl and pyridyl are quite similar, superposing both pairs of
structures (<font color="red">red</font> circles) yielded a small RMSD match.
In the best-scoring case, all the branches off the phenyl ring are
superimposed and more importantly, a number of heteroatoms and
pharmacophore features are aligned.  While the alternate structure has
several superimposed atoms, 
the heteroatoms and pharmacophore features do not correspond well.
Each alignment is scored, duplicate checked, and kept if appropriate.

<h3>Similarity</h3>
All of the methods described above require information about the size and
nature of the common substructure used for alignment. As the experimental
data might not be available, Molecular Superposition provides an undirected
search method that performs an exhaustive search based on matching triplets
of heavy atoms and projected features. This ensures an unbiased coverage of
the search space. Each input structure will be aligned against each template
in turn by the following process:

<ol>
<li>Randomly select a template.
<br /><br />
<li>Randomly select a conformer of the input structure.
<br /><br />
<li>Randomly select an atom triplet in the conformer from (1).
<br /><br />
<li>Randomly select an atom triplet in the template structure from (1) such
that atoms match atoms and projected features match projected features.
<br /><br />
<li>Superpose the triplet pairs and score the results.  Set the failure
count to zero if the score falls within the user-specified thresholds,
otherwise add one to the failure count.
<br /></br />
<li>Repeat steps (1)&nbsp;-&nbsp;(5) until the failure count exceeds the
user-specified rejection limit.
<br /><br />
</ol>

The results are sorted and duplicate results are removed as the calculation
proceeds.  A sample atom triplet is shown below:

<p align="center">
<img src="dbv_molsup/trip1_crop.png" alt="Sample atom triplet"></p>

<h3>Conformers</h3>
This method assumes that the input database contains one or more conformers
of the template(s) (i.e. the same atoms in the same order
with different coordinates).  Each pair of conformers is superposed and
the results are scored by RMSD.  Input
structures that are not conformers of one of the templates are
ignored.

<p>
All these query methods generate a list of positions for each input
structure along with the best-matching template.  These are
ordered by increasing score with the best result (along with scoring
information) written to the input database.  If desired, the best-scoring
position of each input molecule can be refined against the best-matching
template with FlexAlign.  During this refinement the template
is held rigid while the best-scoring match can be rigid or flexible.

<a name="Running"></a>
<h2>Running Molecule Superpose</h2>

To start the Molecule Superpose application, open a database of the structures
to be superposed.  If desired, load the template(s) into the main
MOE window and select
<span class="menu">DBV | Compute | Molecule | Superpose</span>
to start the application:

<p align="center">
<img src="dbv_molsup/panel1.png" alt="Molecule Superpose Panel"></p>

<table cellpadding="5">
<tr>
<td valign="top">
<b>Database</b>
<td valign="top">
This is the name of the input database containing the structures
to be superposed.  One or more data fields will be added to this database
as the application proceeds.

<tr>
<td valign="top">
<b>Selected Entries Only</b>
<td valign="top">
If on, only the selected entries in the Database Viewer of the input database
are used (the rest are ignored).

<tr>
<td valign="top">
<b>Molecule</b>
<td valign="top">
This specifies the database field that contains the input structures.  By
default it is the first available structure field.  The shortcut contains
all the structure fields in the input database.

<tr>
<td valign="top">
<b>Output</b>
<td valign="top">
This specifies the database field that will contain the aligned (output)
structures.  It is used as a prefix for whatever additional information
fields are generated during the calculation.  If omitted, the output
structures will be written to the input field.

<tr>
<td valign="top">
<b>Template</b>
<td valign="top">
The atoms that define the template structure(s) that will be used by
Molecule Superpose.  Press the <b>?</b> button to the right to briefly
highlight (in the MOE window) the specified atoms.
The template(s) can be read from a file by choosing
<b>File</b> from the dropdown menu and pressing <b>Browse...</b>
to select the appropriate MDB file.  It can also be entered into the text
field.  Each MDB entry is assumed to be a single template.  The first field
of type <tt>molecule</tt> or <tt>moe</tt> is used as the template field.

<tr>
<td valign="top">
<b>Query</b>
<td valign="top">
The method used to identify the atom correspondences needed to superpose
the input structures on the template(s):

<table cellpadding="5">
<tr>
<td valign="top">
<b>Selected Atoms</b>
<td valign="top">
A query is generated from the selected atoms in the main MOE window and
used to search both the template(s) and the input structure.
Every match of the template(s) is compared to every match of
the input structure, the corresponding atoms are superposed and the
resulting alignment is scored.

<tr>
<td valign="top">
<b>SMARTS</b>
<td valign="top">
The SMARTS string entered in the adjacent text box is used to search both
the template(s) and the input structure.  Every match of the
template(s) is compared to every match of the input structure,
the corresponding atoms are superposed and the resulting alignment is scored.
Invalid SMARTS strings are highlighted in
<font color="red">red</font> as an aid in constructing queries.

<tr>
<td valign="top">
<b>Sketch</b>
<td valign="top">
Pressing <b>Sketch...</b> opens an external 2D sketcher to let the user
graphically define their query.  The query is used to search both the
template(s) and the input structure.  Every match of the template(s)
is compared to every match of the input structure, the
corresponding atoms are superposed and the resulting alignment is scored.
Consult <span class="nobr">
<a href="../moe/extprog.htm#2DSketchers">2D Sketchers</a></span>
for more information on configuring and using sketchers with MOE.

<tr>
<td valign="top">
<b>Similarity</b>
<td valign="top">
Random, similar heavy-atom and projected feature
triplets are selected from both the input and templates.
The triplets are superposed and the resulting alignment is scored.

<tr>
<td valign="top">
<b>Conformers</b>
<td valign="top">
Input
molecules that are conformers (i.e. the same atoms in the same order
with differing coordinates) of one of the templates are
superposed by atom order and the resulting alignment is scored.

</tr></table>

<tr>
<td valign="top">
<b>Refine With FlexAlign</b>
<td valign="top">
If on, superposed structures will be refined against the corresponding
template using FlexAlign.  The template is held rigid
and the input molecule can be rigid or flexible during this calculation.
The result will be written to the output field.
<br /><br />
<b>Rigid Body</b>, if on, specifies that the input molecule will be kept rigid.
<br /><br />
<b>Calculate Partial Charges</b>, if on, specifies that partial charges using
the current forcefield will be calculated before refining with FlexAlign.
<br /><br />
The FlexAlign parameters and scoring function terms and weights can be set
by pressing the configure icon.  This brings up the
<a href="flex.htm#SettingsPanel">Flexible Alignment Settings</a> panel.

</tr>
</table>

After setting the various options as desired, press <b>Apply</b> or
<b>OK</b> to start the calculation.  Pressing <b>Apply</b> keeps the
<span class="nobr"><b>Molecule Superpose</b></span> panel open, while
<b>OK</b> closes it.
Progress information is provided in the MOE Window as well
as the SVL Commands Window.  Pressing
<span class="nobr"><b>Stop Superpose</b></span> terminates the
calculation.  Upon completion, the database will contain
the following additional fields (assuming <tt>mol_super</tt> is the
<b>Output</b> field name:

<blockquote><table class="titlebar">
<tr>
<th>Field</th>
<th>Description</th>
</tr>
<tr>
<td valign="top">
<b>mol_super</b>
<td valign="top">
A molecule field containing the best-scoring aligned structure generated
by Molecule Superpose.
<tr>
<td valign="top">
<b>mol_super_score</b>
<td valign="top">
The overall score for the aligned structures.  This is constructed as a
weighted sum of the similarity and RMSD scores, with both terms
having similar magnitude.
</table></blockquote>


<a name="Examples"></a>
<h2>Examples</h2>

In this section we will present a number of example calculations using
the Molecule Superpose application.

<div class="example">

<a name="SMARTSQuery"></a>
<h3>Example: Smarts Query</h3>
<ol start="1">
<li><i>Create a local copy of the input database.</i><br />
First clear the system:
<p class="indent_novspace">
<span class="menu">RHS | Close</span></p><br />
Open the input database:
<p class="indent_novspace">
<span class="menu">RHS | Open</span></p>
In the Open panel, select
<span class="nobr"><tt>$MOE/sample/mol/1RO6_ligands.mdb</tt></span> and
press <b>OK</b>.<br /><br />
Save it to disk:
<p class="indent_novspace">
<span class="menu">DBV | File | Save as...</span></p>
In the Save panel, enter
<span class="nobr"><tt>1ro6_ligands.mdb</tt></span> and press <b>Save</b>.
This will be used throughout the sample calculations.
<br /><br />

<li><i>Load the template into MOE.</i></br />
Doubleclick on the first entry of the <tt>mol</tt> column, named <tt>1RO6</tt>.
<br /><br />

<li><i>Start Molecule Superpose</i></br />
<p class="indent_novspace">
<span class="menu">DBV | Compute | Molecule | Superpose...</span></p>
<br />

<li><i>Specify the SMARTS string</i><br />
Change <b>Query</b> to <b>SMARTS</b><br />
Enter <tt>c1ccccc1</tt> in the text box to search for a phenyl group.
Notice that the string turns <font color="red">red</font>
as you are entering it as the partial string is invalid.
</ol>

Press <b>OK</b> to start the Molecular Superpose calculation.  This
writes two fields to the input database: <tt>mol_super</tt> and
<tt>mol_super_score</tt>.
As all the input structures have a phenyl
group, all output fields are populated.
You can browse the <tt>mol_super</tt> column to see the best-scoring
alignment that was generated.
<br /><br />
Some input structures have at least one additional aromatic
ring.  This calculation can be repeated with the SMARTS string
<tt>a1aaaaa1</tt>.
This uses the aromatic wildcard, <tt>a</tt>, and finds all
occurrences of a 6-membered aromatic ring.  Browsing the results
reveals that the phenyl/core alignment remains the best-scoring results.

</div>

<div class="example">

<a name="TripQuery"></a>
<h3>Example: Similarity Query with FlexAlign Refinement</h3>
<ol start="1">
<li><i>Start Molecule Superpose</i></br />
<p class="indent_novspace">
<span class="menu">DBV | Compute | Molecule | Superpose...</span></p><br />

<li>Change <b>Query</b> to <b>Similarity</b><br />
</ol>

Press <b>Apply</b> to start the Molecular Superpose calculation while
leaving the panel up.  This calculation requires a minute or so to
complete, and you can see status information in the MOE window (and
SVL Command Window if open).  It
writes two fields to the input database: <tt>mol_super</tt> and
<tt>mol_super_score</tt>. As
<b>Similarity</b> is an undirected search, all entries in the output
field are populated.
<br /><br />

The effect of FlexAlign refinement can be seen by running a second
calculation with
<span class="nobr"><b>Refine With FlexAlign</b></span> checked.
By default, a flexible refinement is performed and formal charges are
calculated at the start of each refinement.  Change the <b>Output</b>
field to <tt>mol_flex</tt> and press <b>OK</b> to start the calculation.
Due to the seven refinements, a little more time is required.
<br /><br />

Upon completion, a new set of columns are written to the input database.
Browsing <tt>mol_super</tt> and
<tt>mol_flex</tt> shows the effect of FlexAlign refinement.

</div>

<h2>See Also</h2>

<a href="flex.htm">Flexible Alignment of Small Molecules</a><br />
<a href="docking.htm">Docking</a><br />
<br />

<a href="../moe/fcnref/superpos.htm">Superpose functions</a><br />
<a href="../moe/fcnref/smartsfcn.htm#Definition">
    SMARTS language description</a><br />
<a href="../moe/extprog.htm#2DSketchers">2D Sketchers</a>

<noscript>
        <hr noshade="noshade" />
        <font size="2"> Copyright &copy; 1997&ndash;2015
        <a href="http://www.chemcomp.com">Chemical Computing Group Inc.</a> </font>
</noscript>
<div id="MoeFooter"></div>
</body>
</html>

