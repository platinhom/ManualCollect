<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Metadynamics</TITLE>
<META NAME="description" CONTENT="Metadynamics">
<META NAME="keywords" CONTENT="ug">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="ug.css">

<LINK REL="next" HREF="node234.html">
<LINK REL="previous" HREF="node232.html">
<LINK REL="up" HREF="node231.html">
<LINK REL="next" HREF="node234.html">
</HEAD>

<BODY BGCOLOR="WHITE">
<!--Navigation Panel-->
<A NAME="tex2html4506"
  HREF="node234.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html4500"
  HREF="node231.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html4494"
  HREF="node232.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html4502"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html4504"
  HREF="node251.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html4507"
  HREF="node234.html">Harmonic restraints</A>
<B> Up:</B> <A NAME="tex2html4501"
  HREF="node231.html">Biasing and analysis methods</A>
<B> Previous:</B> <A NAME="tex2html4495"
  HREF="node232.html">Adaptive Biasing Force</A>
 &nbsp; <B>  <A NAME="tex2html4503"
  HREF="node1.html">Contents</A></B> 
 &nbsp; <B>  <A NAME="tex2html4505"
  HREF="node251.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html4508"
  HREF="node233.html#SECTION001652100000000000000">Output files</A>
<LI><A NAME="tex2html4509"
  HREF="node233.html#SECTION001652200000000000000">Performance tuning</A>
<LI><A NAME="tex2html4510"
  HREF="node233.html#SECTION001652300000000000000">Well-tempered metadynamics</A>
<LI><A NAME="tex2html4511"
  HREF="node233.html#SECTION001652400000000000000">Multiple-replicas metadynamics</A>
<LI><A NAME="tex2html4512"
  HREF="node233.html#SECTION001652500000000000000">Compatibility and post-processing</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H2><A NAME="SECTION001652000000000000000"></A>
<A NAME="sec:colvarbias_meta"></A>
<BR>
Metadynamics
</H2>

<P>
The metadynamics method uses a history-dependent potential [<A
 HREF="node250.html#Laio2002">45</A>] that generalizes to any type of colvars the conformational flooding [<A
 HREF="node250.html#Grubmuller1995">46</A>] and local elevation [<A
 HREF="node250.html#Huber1994">47</A>] methods, originally formulated to use as colvars the principal components of a covariance matrix or a set of dihedral angles, respectively.
The metadynamics potential on the colvars <!-- MATH
 ${\mbox{\boldmath {$\xi$}}} = (\xi_{1}, \xi_{2}, \ldots, \xi_{N_{\mathrm{cv}}})$
 -->
<B><IMG
 WIDTH="159" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img283.png"
 ALT="$ {\mbox{\boldmath {$\xi$}}} = (\xi_{1}, \xi_{2}, \ldots, \xi_{N_{\mathrm{cv}}})$"></B>
 is defined as:
<P></P>
<DIV ALIGN="CENTER"><A NAME="eq:colvars_meta_pot"></A><!-- MATH
 \begin{equation}
V_{\mathrm{meta}}({\mbox{\boldmath {$\xi$}}}) \; = \; {
    \sum_{t' = \delta{}t, \\2\delta{}t, \\\ldots}^{t'<t} W \: {
      \prod_{i = 1}^{N_{\mathrm{cv}}}
      \exp\left(-\frac{(\xi_{i}-\xi_{i}(t'))^{2}}{2\delta_{\xi_{i}}^{2}}\right)
    }
  }\mathrm{,}
\end{equation}
 -->
<TABLE CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><IMG
 WIDTH="392" HEIGHT="74" ALIGN="MIDDLE" BORDER="0"
 SRC="img284.png"
 ALT="$\displaystyle V_{\mathrm{meta}}({\mbox{\boldmath {$\xi$}}}) \; = \; { \sum_{t' ...
...t(-\frac{(\xi_{i}-\xi_{i}(t'))^{2}}{2\delta_{\xi_{i}}^{2}}\right) } }\mathrm{,}$"></TD>
<TD NOWRAP WIDTH="10" ALIGN="RIGHT">
(13.20)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
where <!-- MATH
 $V_{\mathrm{meta}}$
 -->
<B><IMG
 WIDTH="45" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img285.png"
 ALT="$ V_{\mathrm{meta}}$"></B>
 is the history-dependent potential acting on the <I>current</I> values of the colvars <!-- MATH
 ${\mbox{\boldmath {$\xi$}}}$
 -->
<B><IMG
 WIDTH="14" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img256.png"
 ALT="$ {\mbox{\boldmath {$\xi$}}}$"></B>
, and depends only parametrically on the <I>previous</I> values of the colvars.
<!-- MATH
 $V_{\mathrm{meta}}$
 -->
<B><IMG
 WIDTH="45" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img285.png"
 ALT="$ V_{\mathrm{meta}}$"></B>
 is constructed as a sum of <!-- MATH
 $N_{\mathrm{cv}}$
 -->
<B><IMG
 WIDTH="33" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img286.png"
 ALT="$ N_{\mathrm{cv}}$"></B>
-dimensional repulsive Gaussian ``hills'', whose height is a chosen energy constant <B><IMG
 WIDTH="23" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img287.png"
 ALT="$ W$"></B>
, and whose centers are the previously explored configurations <!-- MATH
 $\left({\mbox{\boldmath {$\xi$}}}(\delta{}t), {\mbox{\boldmath {$\xi$}}}(2\delta{}t), \ldots\right)$
 -->
<B><IMG
 WIDTH="138" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img288.png"
 ALT="$ \left({\mbox{\boldmath {$\xi$}}}(\delta{}t), {\mbox{\boldmath {$\xi$}}}(2\delta{}t), \ldots\right)$"></B>
.
Each Gaussian functions has a width of approximately <!-- MATH
 $2\delta_{\xi_{i}}$
 -->
<B><IMG
 WIDTH="33" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img289.png"
 ALT="$ 2\delta_{\xi_{i}}$"></B>
 along the direction of the <B><IMG
 WIDTH="10" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="img42.png"
 ALT="$ i$"></B>
-th colvar.

<P>
During the simulation, the system evolves towards the nearest minimum of the ``effective'' potential of mean force <!-- MATH
 $\tilde{A}({\mbox{\boldmath {$\xi$}}})$
 -->
<B><IMG
 WIDTH="40" HEIGHT="40" ALIGN="MIDDLE" BORDER="0"
 SRC="img290.png"
 ALT="$ \tilde{A}({\mbox{\boldmath {$\xi$}}})$"></B>
, which is the sum of the ``real'' underlying potential of mean force <!-- MATH
 $A({\mbox{\boldmath {$\xi$}}})$
 -->
<B><IMG
 WIDTH="40" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img291.png"
 ALT="$ A({\mbox{\boldmath {$\xi$}}})$"></B>
 and the the metadynamics potential <!-- MATH
 $V_{\mathrm{meta}}({\mbox{\boldmath {$\xi$}}})$
 -->
<B><IMG
 WIDTH="68" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img292.png"
 ALT="$ V_{\mathrm{meta}}({\mbox{\boldmath {$\xi$}}})$"></B>
.
Therefore, at any given time the probability of observing the configuration <!-- MATH
 ${\mbox{\boldmath {$\xi^{*}$}}}$
 -->
<B><IMG
 WIDTH="22" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img293.png"
 ALT="$ {\mbox{\boldmath {$\xi^{*}$}}}$"></B>
 is proportional to <!-- MATH
 $\exp\left(-\tilde{A}({\mbox{\boldmath {$\xi^{*}$}}})/\kappa_{\mathrm{B}}T\right)$
 -->
<B><IMG
 WIDTH="155" HEIGHT="48" ALIGN="MIDDLE" BORDER="0"
 SRC="img294.png"
 ALT="$ \exp\left(-\tilde{A}({\mbox{\boldmath {$\xi^{*}$}}})/\kappa_{\mathrm{B}}T\right)$"></B>
: this is also the probability that a new Gaussian ``hill'' is added at that configuration.
If the simulation is run for a sufficiently long time, each local minimum is canceled out by the sum of the Gaussian ``hill'' functions.
At that stage the the ``effective'' potential of mean force <!-- MATH
 $\tilde{A}({\mbox{\boldmath {$\xi$}}})$
 -->
<B><IMG
 WIDTH="40" HEIGHT="40" ALIGN="MIDDLE" BORDER="0"
 SRC="img290.png"
 ALT="$ \tilde{A}({\mbox{\boldmath {$\xi$}}})$"></B>
 is constant, and <!-- MATH
 $-V_{\mathrm{meta}}({\mbox{\boldmath {$\xi$}}})$
 -->
<B><IMG
 WIDTH="81" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img295.png"
 ALT="$ -V_{\mathrm{meta}}({\mbox{\boldmath {$\xi$}}})$"></B>
 is an accurate estimator of the ``real'' potential of mean force <!-- MATH
 $A({\mbox{\boldmath {$\xi$}}})$
 -->
<B><IMG
 WIDTH="40" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img291.png"
 ALT="$ A({\mbox{\boldmath {$\xi$}}})$"></B>
, save for an additive constant:
<P></P>
<DIV ALIGN="CENTER"><A NAME="eq:colvars_meta_fes"></A><!-- MATH
 \begin{equation}
A({\mbox{\boldmath {$\xi$}}}) \; \simeq \; {
    -V_{\mathrm{meta}}({\mbox{\boldmath {$\xi$}}}) + K
  }
\end{equation}
 -->
<TABLE CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><IMG
 WIDTH="187" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img296.png"
 ALT="$\displaystyle A({\mbox{\boldmath {$\xi$}}}) \; \simeq \; { -V_{\mathrm{meta}}({\mbox{\boldmath {$\xi$}}}) + K }$"></TD>
<TD NOWRAP WIDTH="10" ALIGN="RIGHT">
(13.21)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>

<P>
Assuming that the set of collective variables includes all relevant degrees of freedom, the predicted error of the estimate is a simple function of the correlation times of the colvars <!-- MATH
 $\tau_{\xi_{i}}$
 -->
<B><IMG
 WIDTH="24" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img297.png"
 ALT="$ \tau_{\xi_{i}}$"></B>
, and of the user-defined parameters <B><IMG
 WIDTH="23" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img287.png"
 ALT="$ W$"></B>
, <!-- MATH
 $\delta_{\xi_{i}}$
 -->
<B><IMG
 WIDTH="24" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img298.png"
 ALT="$ \delta_{\xi_{i}}$"></B>
 and <B><IMG
 WIDTH="19" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img299.png"
 ALT="$ \delta{}t$"></B>
 [<A
 HREF="node250.html#Bussi2006">48</A>]. 
In typical applications, a good rule of thumb can be to choose the ratio <!-- MATH
 $W/\delta{}t$
 -->
<B><IMG
 WIDTH="45" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img300.png"
 ALT="$ W/\delta{}t$"></B>
 much smaller than <!-- MATH
 $\kappa_{\mathrm{B}}T/\tau_{{\mbox{\boldmath {$\xi$}}}}$
 -->
<B><IMG
 WIDTH="63" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img301.png"
 ALT="$ \kappa_{\mathrm{B}}T/\tau_{{\mbox{\boldmath {$\xi$}}}}$"></B>
, where <!-- MATH
 $\tau_{{\mbox{\boldmath {$\xi$}}}}$
 -->
<B><IMG
 WIDTH="22" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img302.png"
 ALT="$ \tau_{{\mbox{\boldmath {$\xi$}}}}$"></B>
 is the longest among <!-- MATH
 ${\mbox{\boldmath {$\xi$}}}$
 -->
<B><IMG
 WIDTH="14" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img256.png"
 ALT="$ {\mbox{\boldmath {$\xi$}}}$"></B>
's correlation times: <!-- MATH
 $\delta_{\xi_{i}}$
 -->
<B><IMG
 WIDTH="24" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img298.png"
 ALT="$ \delta_{\xi_{i}}$"></B>
 then dictates the resolution of the calculated PMF.

<P>
To enable a metadynamics calculation, a <TT>metadynamics</TT> block must be defined in the colvars configuration file. 
Its only mandatory keyword is the <TT>colvars</TT> option listing all the variables involved: multidimensional PMFs are obtained by the same <TT>metadynamics</TT> instance applied to all the colvars.

<P>
The parameters <B><IMG
 WIDTH="23" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img287.png"
 ALT="$ W$"></B>
 and <B><IMG
 WIDTH="19" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img299.png"
 ALT="$ \delta{}t$"></B>
 are specified by the keywords <TT>hillWeight</TT> and <TT>newHillFrequency</TT>, respectively.
The values of these options are optimal for colvars with correlation times <!-- MATH
 $\tau_{{\mbox{\boldmath {$\xi$}}}}$
 -->
<B><IMG
 WIDTH="22" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img302.png"
 ALT="$ \tau_{{\mbox{\boldmath {$\xi$}}}}$"></B>
 in the range of a few thousand simulation steps, typical of many biomolecular simulations:

<UL>
<LI><A NAME="22592"></A>
  <B><FONT SIZE="+1"><TT>hillWeight </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Height of each hill (kcal/mol)<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> positive decimal 
<BR><B>Default value: </B> <TT>0.01</TT> 
<BR><B>Description: </B> This option sets the height <B><IMG
 WIDTH="23" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img287.png"
 ALT="$ W$"></B>
 of the hills that are added during
    this run.  Lower values provide more accurate sampling at the price
    of longer simulation times to complete a PMF calculation.

<P>
</LI>
<LI><A NAME="22614"></A>
  <B><FONT SIZE="+1"><TT>newHillFrequency </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Frequency of hill creation<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> positive integer 
<BR><B>Default value: </B> <TT>1000</TT> 
<BR><B>Description: </B> This option sets the number of integration steps after which a new
    hill is added to the metadynamics potential.  Its value determines
    the parameter <B><IMG
 WIDTH="19" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img299.png"
 ALT="$ \delta{}t$"></B>
 in eq.&nbsp;<A HREF="#eq:colvars_meta_pot">13.21</A>.  Higher
    values provide more accurate sampling at the price of longer
    simulation times to complete a PMF calculation.

<P>
</LI>
</UL>

<P>
It is the user's responsibility to either leave <TT>hillWeight</TT> and <TT>newHillFrequency</TT> at their default values, or to change them to match the specifics of each system.
The parameter <!-- MATH
 $\delta_{\xi_{i}}$
 -->
<B><IMG
 WIDTH="24" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img298.png"
 ALT="$ \delta_{\xi_{i}}$"></B>
 is instead defined as approximately half the <TT>width</TT> of the corresponding colvar <B><IMG
 WIDTH="17" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img139.png"
 ALT="$ \xi_{i}$"></B>
 (see <A HREF="node216.html#sec:colvar_general">13.2.1</A>).

<P>

<H3><A NAME="SECTION001652100000000000000"></A>
<A NAME="sec:colvarbias_meta_output"></A>
<BR>
Output files
</H3>
When interpolating grids are enabled (default behavior), the PMF is written every <TT>colvarsRestartFrequency</TT> steps to the file <I>outputName</I><TT>.pmf</TT>.
The following two options allow to control this behavior and to visually track statistical convergence:

<P>

<UL>
<LI><A NAME="22636"></A>
  <B><FONT SIZE="+1"><TT>writeFreeEnergyFile </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Periodically write the PMF for visualization<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> boolean 
<BR><B>Default value: </B> <TT>on</TT> 
<BR><B>Description: </B> When <TT>useGrids</TT> and this option are <TT>on</TT>, the PMF is
    written every <TT>colvarsRestartFrequency</TT> steps.

<P>
</LI>
<LI><A NAME="22657"></A>
  <B><FONT SIZE="+1"><TT>saveFreeEnergyFile </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Keep all the PMF files<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> boolean 
<BR><B>Default value: </B> <TT>off</TT> 
<BR><B>Description: </B> When <TT>writeFreeEnergyFile</TT> and this option are <TT>on</TT>,
    the step number is included in the file name.  Activating this
    option can be useful to follow more closely the convergence of the
    simulation, by comparing PMFs separated by short times.

<P>
</LI>
</UL>

<P>
<B>Note:</B> when Gaussian hills are deposited near <TT>lowerBoundary</TT> or <TT>upperBoundary</TT> (see <A HREF="node216.html#sec:colvar_general">13.2.1</A>) and interpolating grids are used (default behavior), their truncation can give rise to accumulating errors.
In these cases, as a measure of fault-tolerance all Gaussian hills near the boundaries are included in the output state file, and are recalculated analytically whenever the colvar falls outside the grid's boundaries.
(Such measure protects the accuracy of the calculation, and can only be disabled by <TT>hardLowerBoundary</TT> or <TT>hardUpperBoundary</TT>.)
To avoid gradual loss of performance and growth of the state file, either one of the following solutions is recommended:

<UL>
<LI>enabling the option <TT>expandBoundaries</TT>, so that the grid's boundaries are automatically recalculated whenever necessary; the resulting <TT>.pmf</TT> will have its abscissas expanded accordingly;
</LI>
<LI>setting <TT>lowerWall</TT> and <TT>upperWall</TT> well within the interval delimited by <TT>lowerBoundary</TT> and <TT>upperBoundary</TT>.
</LI>
</UL>

<P>

<H3><A NAME="SECTION001652200000000000000"></A>
<A NAME="sec:colvarbias_meta_performance"></A>
<BR>
Performance tuning
</H3>
The following options control the computational cost of metadynamics calculations, but do not affect results.
Default values are chosen to minimize such cost with no loss of accuracy.

<P>

<UL>
<LI><A NAME="22678"></A>
  <B><FONT SIZE="+1"><TT>useGrids </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Interpolate the hills with grids<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> boolean 
<BR><B>Default value: </B> <TT>on</TT> 
<BR><B>Description: </B> This option discretizes all hills for improved performance,
    accumulating their energy and their gradients on two separate grids
    of equal spacing.  Grids are defined by the values of
    <TT>lowerBoundary</TT>, <TT>upperBoundary</TT> and <TT>width</TT>
    for each colvar.  Currently, this option is implemented for all
    types of variables except the non-scalar types (<TT>distanceDir</TT>
    or <TT>orientation</TT>).  If <TT>expandBoundaries</TT> is defined
    in one of the colvars, grids are automatically expanded along the
    direction of that colvar.

<P>
</LI>
<LI><A NAME="22702"></A>
  <B><FONT SIZE="+1"><TT>hillWidth </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Relative width of the hills<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> positive decimal 
<BR><B>Default value: </B> <!-- MATH
 $\sqrt{2\pi}/2$
 -->
<B><IMG
 WIDTH="56" HEIGHT="39" ALIGN="MIDDLE" BORDER="0"
 SRC="img303.png"
 ALT="$ \sqrt{2\pi}/2$"></B>
 
<BR><B>Description: </B> Along each colvar, the width of each Gaussian hill
    (<!-- MATH
 $2\delta_{\xi_{i}}$
 -->
<B><IMG
 WIDTH="33" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img289.png"
 ALT="$ 2\delta_{\xi_{i}}$"></B>
) is given by the product between this number
    and the colvar's <TT>width</TT>.  The default value gives hills
    whose volume is the product of <B><IMG
 WIDTH="23" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img287.png"
 ALT="$ W$"></B>
 times the <TT>width</TT> of all
    colvars.  For a smoother visualization of the free energy plot,
    decrease <TT>width</TT> and increase <TT>hillWidth</TT> in the same
    proportion.  <B>Note:</B> <I>when </I><TT>useGrids</TT><I> is
    </I><TT>on</TT><I> (default in most cases), values smaller than 1
      should be avoided to avoid discretization errors</I>.

<P>
</LI>
<LI><A NAME="22732"></A>
  <B><FONT SIZE="+1"><TT>rebinGrids </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Recompute the grids when reading a state
    file<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> boolean 
<BR><B>Default value: </B> <TT>off</TT> 
<BR><B>Description: </B> When restarting from a state file, the grid's parameters (boundaries
    and widths) saved in the state file override those in the
    configuration file.  Enabling this option forces the grids to match
    those in the current configuration file.

<P>
</LI>
</UL>

<P>

<H3><A NAME="SECTION001652300000000000000"></A>
<A NAME="sec:colvarbias_well_tempered"></A>
<BR>
Well-tempered metadynamics
</H3>
The following options define the configuration for the ``well-tempered'' metadynamics approach [<A
 HREF="node250.html#Barducci2008">49</A>]:

<P>

<UL>
<LI><A NAME="22751"></A>
  <B><FONT SIZE="+1"><TT>wellTempered </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Perform well-tempered metadynamics<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> boolean 
<BR><B>Default value: </B> <TT>off</TT> 
<BR><B>Description: </B> If enabled, this flag causes well-tempered metadynamics as
    described by Barducci et al.[<A
 HREF="node250.html#Barducci2008">49</A>]
    to be performed, rather than standard metadynamics.  The parameter
    <TT>biasTemperature</TT> is then required.

<P>
</LI>
<LI><A NAME="22772"></A>
  <B><FONT SIZE="+1"><TT>biasTemperature </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Temperature bias for well-tempered metadynamics<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> positive decimal 
<BR><B>Description: </B> When running metadynamics in the long time limit, collective variable space is sampled to a modified
    temperature <!-- MATH
 $T+\Delta T$
 -->
<B><IMG
 WIDTH="65" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img304.png"
 ALT="$ T+\Delta T$"></B>
.  In conventional metadynamics, the temperature ``boost'' <B><IMG
 WIDTH="32" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img305.png"
 ALT="$ \Delta T$"></B>
 would
    constantly increases with time.  Instead, in well-tempered metadynamics <B><IMG
 WIDTH="32" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img305.png"
 ALT="$ \Delta T$"></B>
 must be defined by the
    user via <TT>biasTemperature</TT>.  If <TT>dumpFreeEnergyFile</TT> is enabled, the written PMF includes the
    scaling factor <!-- MATH
 $(T+\Delta T)/\Delta T$
 -->
<B><IMG
 WIDTH="115" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img306.png"
 ALT="$ (T+\Delta T)/\Delta T$"></B>
 [<A
 HREF="node250.html#Barducci2008">49</A>].  A careful choice of <B><IMG
 WIDTH="32" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img305.png"
 ALT="$ \Delta T$"></B>
 determines the
    sampling and convergence rate, and is hence crucial to the success of a well-tempered metadynamics
    simulation.
</LI>
</UL>

<P>

<H3><A NAME="SECTION001652400000000000000"></A>
<A NAME="sec:colvarbias_meta_mr"></A>
<BR>
Multiple-replicas metadynamics
</H3>
The following options define metadynamics calculations with more than
one replica:

<P>

<UL>
<LI><A NAME="22792"></A>
  <B><FONT SIZE="+1"><TT>multipleReplicas </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Multiple replicas metadynamics<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> boolean 
<BR><B>Default value: </B> <TT>off</TT> 
<BR><B>Description: </B> If this option is <TT>on</TT>, multiple (independent) replica of the
    same system can be run at the same time, and their hills will be
    combined to obtain a single PMF [<A
 HREF="node250.html#Raiteri2005">50</A>].  Replicas are
    identified by the value of <TT>replicaID</TT>.  Communication is
    done by files: each replica must be able to read the files
    created by the others, whose paths are communicated through the file
    <TT>replicasRegistry</TT>.  This file, and the files listed in it,
    are read every <TT>replicaUpdateFrequency</TT> steps.  Every time
    the colvars state file is written
    (<TT>colvarsRestartFrequency</TT>), the file:
<BR>    ``<I>outputName</I><TT>.colvars.</TT><I>name</I><TT>.</TT><I>replicaID</I><TT>.state</TT>''
    is also written, containing
    the state of the metadynamics bias for <TT>replicaID</TT>.  In the
    time steps between <TT>colvarsRestartFrequency</TT>, new hills are
    temporarily written to the file:
<BR>    ``<I>outputName</I><TT>.colvars.</TT><I>name</I><TT>.</TT><I>replicaID</I><TT>.hills</TT>'',
    which serves as communication
    buffer.  These files are only required for communication, and may be
    deleted after a new MD run is started with a different
    <TT>outputName</TT>.  

<P>
</LI>
<LI><A NAME="22830"></A>
  <B><FONT SIZE="+1"><TT>replicaID </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Set the identifier for this replica<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> string 
<BR><B>Description: </B> If <TT>multipleReplicas</TT> is <TT>on</TT>, this option sets a
    unique identifier for this replica.  All replicas should use
    identical collective variable configurations, except for the value
    of this option.

<P>
</LI>
<LI><A NAME="22848"></A>
  <B><FONT SIZE="+1"><TT>replicasRegistry </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Multiple replicas database file<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> UNIX filename 
<BR><B>Default value: </B> ``<I>name</I><TT>.replica_files.txt</TT>'' 
<BR><B>Description: </B> If <TT>multipleReplicas</TT> is <TT>on</TT>, this option sets the
    path to the replicas' database file.
    
<P>
</LI>
<LI><A NAME="22869"></A>
  <B><FONT SIZE="+1"><TT>replicaUpdateFrequency </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
How often hills are communicated between
    replicas<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> positive integer 
<BR><B>Default value: </B> <TT>newHillFrequency</TT> 
<BR><B>Description: </B> If <TT>multipleReplicas</TT> is <TT>on</TT>, this option sets the
    number of steps after which each replica (re)reads the other
    replicas' files.  The lowest meaningful value of this number is
    <TT>newHillFrequency</TT>.  If access to the file system is
    significantly affecting the simulation performance, this number can
    be increased, at the price of reduced synchronization between
    replicas.  Values higher than <TT>colvarsRestartFrequency</TT> may
    not improve performance significantly.

<P>
</LI>
<LI><A NAME="22891"></A>
  <B><FONT SIZE="+1"><TT>dumpPartialFreeEnergyFile </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Periodically write the contribution to the
    PMF from this replica<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> boolean 
<BR><B>Default value: </B> <TT>on</TT> 
<BR><B>Description: </B> When <TT>multipleReplicas</TT> is <TT>on</TT>, tje file
    <I>outputName</I><TT>.pmf</TT> contains the combined PMF from all
    replicas.  Enabling this option produces an additional file
    <I>outputName</I><TT>.partial.pmf</TT>, which can be useful to
    quickly monitor the contribution of each replica to the PMF.  The
    requirements for this option are the same as
    <TT>dumpFreeEnergyFile</TT>.

<P>
</LI>
</UL>

<P>

<H3><A NAME="SECTION001652500000000000000">
Compatibility and post-processing</A>
</H3>
The following options may be useful only for applications that go beyond the calculation of a PMF by metadynamics:

<UL>
<LI><A NAME="22917"></A>
  <B><FONT SIZE="+1"><TT>name </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Name of this metadynamics instance<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> string 
<BR><B>Default value: </B> ``<TT>meta</TT>'' + rank number 
<BR><B>Description: </B> This option sets the name for this metadynamics instance.  While it
    is not advisable to use more than one metadynamics instance within
    the same simulation, this allows to distinguish each instance from
    the others.  If there is more than one metadynamics instance, the
    name of this bias is included in the metadynamics output file names, such as e.g.&nbsp;the <TT>.pmf</TT> file.

<P>
</LI>
<LI><A NAME="22936"></A>
  <B><FONT SIZE="+1"><TT>keepHills </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Write each individual hill to the state
    file<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> boolean 
<BR><B>Default value: </B> <TT>off</TT> 
<BR><B>Description: </B> When <TT>useGrids</TT> and this option are <TT>on</TT>, all hills
    are saved to the state file in their analytic form, alongside their
    grids.  This makes it possible to later use exact analytic Gaussians
    for <TT>rebinGrids</TT>.  To only keep track of the history of the
    added hills, <TT>writeHillsTrajectory</TT> is preferable.

<P>
</LI>
<LI><A NAME="22958"></A>
  <B><FONT SIZE="+1"><TT>writeHillsTrajectory </TT></FONT></B> <B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$ \langle\,$"></B>
Write a log of new hills<B><IMG
 WIDTH="14" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$ \,\rangle$"></B>
 
<BR><B>Context: </B> <TT>metadynamics</TT> 
<BR><B>Acceptable values: </B> boolean 
<BR><B>Default value: </B> <TT>on</TT> 
<BR><B>Description: </B> If this option is <TT>on</TT>, a logfile is written by the
    <TT>metadynamics</TT> bias, with the name
    ``<I>outputName</I><TT>.colvars.<B><IMG
 WIDTH="18" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img5.png"
 ALT="$ &lt;$"></B>
name<B><IMG
 WIDTH="18" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$ &gt;$"></B>
.hills.traj</TT>'', which
    can be useful to follow the time series of the hills.  When
    <TT>multipleReplicas</TT> is <TT>on</TT>, its name changes to
<BR>    ``<I>outputName</I><TT>.colvars.<B><IMG
 WIDTH="18" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img5.png"
 ALT="$ &lt;$"></B>
name<B><IMG
 WIDTH="18" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$ &gt;$"></B>
.<B><IMG
 WIDTH="18" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img5.png"
 ALT="$ &lt;$"></B>
replicaID<B><IMG
 WIDTH="18" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img4.png"
 ALT="$ &gt;$"></B>
.hills.traj</TT>''.
    This file can be used to quickly visualize the positions of all
    added hills, in case <TT>newHillFrequency</TT> does not coincide
    with <TT>colvarsRestartFrequency</TT>.

<P>
</LI>
</UL>

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html4506"
  HREF="node234.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html4500"
  HREF="node231.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html4494"
  HREF="node232.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html4502"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html4504"
  HREF="node251.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html4507"
  HREF="node234.html">Harmonic restraints</A>
<B> Up:</B> <A NAME="tex2html4501"
  HREF="node231.html">Biasing and analysis methods</A>
<B> Previous:</B> <A NAME="tex2html4495"
  HREF="node232.html">Adaptive Biasing Force</A>
 &nbsp; <B>  <A NAME="tex2html4503"
  HREF="node1.html">Contents</A></B> 
 &nbsp; <B>  <A NAME="tex2html4505"
  HREF="node251.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
vmd@ks.uiuc.edu
</ADDRESS>
</BODY>
</HTML>
