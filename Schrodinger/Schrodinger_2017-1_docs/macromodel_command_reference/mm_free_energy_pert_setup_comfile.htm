<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-US" xml:lang="en-US" data-mc-search-type="Stem" data-mc-help-system-file-name="Documentation.xml" data-mc-path-to-help-system="../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Command References|MacroModel Command Reference|Free Energy Simulations with MacroModel|Setting Up MacroModel FEP Calculations">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" /><title>The Command File for MacroModel FEP Calculations</title>
        <link href="../Resources/TableStyles/StandardRules.css" rel="stylesheet" data-mc-stylesheet-type="table" />
        <link href="../Resources/Stylesheets/docs.css" rel="stylesheet" />
        <script src="../Resources/Scripts/custom.modernizr.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/require.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/require.config.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/foundation.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/plugins.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/MadCapAll.js" type="text/javascript">
        </script>
    </head>
    <body><a name="aanchor4957"></a>
        <MadCap:concept term="Command Reference" /><a name="aanchor4958"></a>
        <MadCap:concept term="MacroModel" /><a name="mm_free_energy_pert_3887848488_738201"></a>
        <table class="NavLink" data-mc-conditions="Default.ScreenOnly">
            <tr class="NavLink">
                <td class="NavLeft"><span class="NavText">◀ <a class="NavLink MCXref xref xrefNavLink" href="mm_free_energy_pert_setup_structure.htm">The Structure File for MacroModel FEP Calculations</a></span>
                </td>
                <td class="NavCenter"><span class="NavText"><a class="NavLink MCXref xref xrefNavLink" href="macromodel_command_referenceTOC.htm">MacroModel Command Reference Manual</a></span>
                </td>
                <td class="NavRight"><span class="NavText"><a class="NavLink MCXref xref xrefNavLink" href="mm_free_energy_pert_setup_other.htm">Other Possible Command Files for MacroModel FEP Calculations</a> ▶</span>
                </td>
            </tr>
        </table>
        <h1 class="Title">The Command File for MacroModel FEP Calculations</h1>
        <p>The command file used to perform the perturbation of the <span class="SmallCaps">l</span> to the <span class="SmallCaps">d</span> form is shown below. </p><pre>
fep.mae
fep-out.mae
 EXNB       0      0      0      0     0.0000     0.0000     0.0000     0.0000
 BDCO       0      0      0      0     0.0000     0.0000     0.0000     0.0000
 FFLD       3      0      0      0     0.0000     0.0000     0.0000     0.0000
 READ       0      0      0      0     0.0000     0.0000     0.0000     0.0000
 FEIA       0      0      0      0     0.0000     0.0000     0.0000     0.0000
 MCNV       1      2      0      0     0.0000     0.0000     0.0000     0.0000
 MCSD       1      2      0      0     0.0000     0.0000   300.0000     0.0000
 TORS       5      6      0      0    30.0000   180.0000     0.0000     0.0000
 TORS       6      7      0      0    30.0000   180.0000     0.0000     0.0000
 BGIN       0      0      0      0     0.0000     0.0000     0.0000     0.0000
 FEAV       0      0      0      0     0.0000     0.0000     0.0000     0.0000
 MINI       1      0   1000      0     0.0000     0.0000     0.0000     0.0000
 MDIT       0      0      0      0   300.0000     0.0000     0.0000     0.0000
 MDYN       0      0      1      0     1.5000    10.0000   300.0000     0.0000
 FESA       0      0      0      0     0.0000     0.0500     0.0000     0.0000
 MDYN       0      0      1      0     1.5000   100.0000   300.0000     0.0000
 END        0      0      0      0     0.0000     0.0000     0.0000     0.0000
 FESU       0      0      0      0     0.0000     0.0000     0.0000     0.0000
</pre>
        <p><span class="CodeLink"><a href="opcodes_ffld.htm#opcodes_509685220_exnb">EXNB</a></span>: Extended non-bonded cutoffs should be used in free energy calculations. </p>
        <p><span class="CodeLink"><a href="opcodes_ffld.htm#opcodes_509685220_ffld">FFLD</a></span>: This example used the AMBER* force field with the default distance-dependent dielectric treatment for electrostatics. We also recommend the use of the GB/SA solvation model in a real application.</p>
        <p><span class="CodeLink"><a href="opcodes_file.htm#opcodes_509685220_read">READ</a></span>: Required to read the first structure in the <code>.mae</code> file.</p>
        <p><span class="CodeLink"><a href="opcodes_fep.htm#opcodes_509685220_feia">FEIA</a></span>: Reads the second structure (the perturbation endpoint) from the <code>.mae</code> file and sets up the arrays for averaging of the interactions. </p>
        <p><span class="CodeLink"><a href="opcodes_csearch.htm#opcodes_509685220_mcnv">MCNV</a></span>: Specifies that between 1 and 2 of the torsions specified by <code>TORS</code> commands will be varied at each MC step.</p>
        <p><span class="CodeLink"><a href="opcodes_mdmc.htm#opcodes_509685220_mcsd">MCSD</a></span>: In this example we use mixed-mode Monte Carlo/Stochastic Dynamics to perform the simulation. Because a successful FEP simulation requires a thorough sampling of the conformation space at each window, we strongly recommend using the mixed-mode simulation method during free energy calculations. </p>
        <p><span class="CodeLink"><a href="opcodes_csearch.htm#opcodes_509685220_tors">TORS</a></span>: Defines the torsion angles used in the Monte Carlo part of the <code>MCSD</code> calculation. In this case it is the <span class="Symbol">f</span> and <span class="Symbol">y</span> angles of the dipeptide. </p>
        <p><span class="CodeLink"><a href="opcodes_flowcontrol.htm#opcodes_509685220_bgin">BGIN</a></span>: Free energy perturbation calculations are usually performed in a <code>BGIN/END</code> loop, which completes all the windows from <span class="Symbol">l</span>=0 to <span class="Symbol">l</span>=1. </p>
        <p><span class="CodeLink"><a href="opcodes_fep.htm#opcodes_509685220_feav">FEAV</a></span>: Generates the interactions corresponding to the value of <span class="Symbol">l</span> given in arg5. The interpretation of this command can lead to some confusion. The first time it is encountered, it will generate an interaction array with the value of lambda as given in arg5. When placed inside a <code>BGIN/END</code> pair, as in this example, the behavior is slightly different—when subsequently encountered, the <code>FEAV</code> command will increment the current value of <span class="Symbol">l</span> (i.e., the middle of the double wide sampling window) by the difference between arg5 and arg6 in the following <code>FESA</code> command. In this case it will be incremented to 0.05 the first time through the <code>BGIN/END</code> loop.</p>
        <p><span class="CodeLink"><a href="opcodes_minimization.htm#opcodes_509685220_mini">MINI</a></span>: Once the interactions are generated, it is necessary to minimize the structure with this set of interactions in order to remove any excess potential energy before beginning the dynamics part of the simulation. </p>
        <p><span class="CodeLink"><a href="opcodes_mdmc.htm#opcodes_509685220_mdit">MDIT</a></span>: Sets initial random velocities corresponding to an initial temperature of the value of arg5 (in this case, 300° K). </p>
        <p><span class="CodeLink"><a href="opcodes_mdmc.htm#opcodes_509685220_mdyn">MDYN</a></span>: At any given value of l (i.e., at the start of every window) it is good practice to first perform a short equilibration simulation before collecting data for the free energy calculation. </p>
        <p><span class="CodeLink"><a href="opcodes_fep.htm#opcodes_509685220_fesa">FESA</a></span>: Begins the collection of free energy samples for the current value of (<span class="Symbol">l</span>)—the middle of the window. The values of arg5 and arg6 indicate the values of the left side of the window and the right side of the window for double wide sampling. The difference between the values of arg5 and arg6 controls the number of windows which will be performed in the simulation—the relationship is #windows&#160;=&#160;1/(arg6−arg5)&#160;+&#160;1. A maximum of 101 windows can be used in a MacroModel FEP calculation so the minimum permissible value of the difference between arg5 and arg6 is 0.01. When used inside a <code>BGIN/END</code> pair, as in this example, arg5 and arg6 will be incremented each pass through the loop, as illustrated in the table below.</p>
        <p>Most simulations require at least 20 windows to ensure that the free energy difference per window (which must be &lt;3 RT) remains sufficiently small. </p>
        <table class="TableStyle-StandardRules" style="caption-side: top;mc-table-style: url('../Resources/TableStyles/StandardRules.css');" cellspacing="0">
            <thead>
                <tr class="TableStyle-StandardRules-Head-Header1">
                    <td class="TableStyle-StandardRules-HeadE-Column1-Header1">
                        <p class="Cell_Heading"><span class="_Override">Pass</span>
                        </p>
                    </td>
                    <td class="TableStyle-StandardRules-HeadE-Column1-Header1">
                        <p class="Cell_Heading"><span class="Symbol">l</span>(left)</p>
                    </td>
                    <td class="TableStyle-StandardRules-HeadE-Column1-Header1">
                        <p class="Cell_Heading"><span class="Symbol">l</span>(middle)</p>
                    </td>
                    <td class="TableStyle-StandardRules-HeadE-Column1-Header1">
                        <p class="Cell_Heading"><span class="Symbol">l</span>(right) </p>
                    </td>
                    <td class="TableStyle-StandardRules-HeadD-Column1-Header1">
                        <p class="Cell_Heading">&#160;</p>
                    </td>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-StandardRules-Body-Body1">
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body1">
                        <p class="Cell_Body">1</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body1">
                        <p class="Cell_Body">0.00</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body1">
                        <p class="Cell_Body">0.00</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body1">
                        <p class="Cell_Body">0.05</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyG-Column1-Body1">
                        <p class="Cell_Body">(no middle-&gt;left sampling)</p>
                    </td>
                </tr>
                <tr class="TableStyle-StandardRules-Body-Body1">
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body1">
                        <p class="Cell_Body">2</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body1">
                        <p class="Cell_Body">0.0 </p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body1">
                        <p class="Cell_Body">0.05</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body1">
                        <p class="Cell_Body">0.10</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyD-Column1-Body1">
                        <p class="Cell_Body">(middle-&gt;left and left-&gt;right) </p>
                    </td>
                </tr>
                <tr class="TableStyle-StandardRules-Body-Body2">
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body2">
                        <p class="Cell_Body">3</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body2">
                        <p class="Cell_Body">0.05</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body2">
                        <p class="Cell_Body">0.10</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body2">
                        <p class="Cell_Body">0.15</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyG-Column1-Body2">
                        <p class="Cell_Body">(middle-&gt;left and left-&gt;right) </p>
                    </td>
                </tr>
                <tr class="TableStyle-StandardRules-Body-Body2">
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body2">
                        <p class="Cell_Body">4</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body2">
                        <p class="Cell_Body">0.10</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body2">
                        <p class="Cell_Body">0.15</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body2">
                        <p class="Cell_Body">0.20</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyD-Column1-Body2">
                        <p class="Cell_Body">(middle-&gt;left and left-&gt;right) </p>
                    </td>
                </tr>
                <tr class="TableStyle-StandardRules-Body-Body1">
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body1">
                        <p class="Cell_Body">&#160;</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body1">
                        <p class="Cell_Body">&#160;</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body1">
                        <p class="Cell_Body">&#160;</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body1">
                        <p class="Cell_Body">&#160;</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyG-Column1-Body1">
                        <p class="Cell_Body">&#160;</p>
                    </td>
                </tr>
                <tr class="TableStyle-StandardRules-Body-Body1">
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body1">
                        <p class="Cell_Body">20</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body1">
                        <p class="Cell_Body">0.90</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body1">
                        <p class="Cell_Body">0.95</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body1">
                        <p class="Cell_Body">1.00</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyD-Column1-Body1">
                        <p class="Cell_Body">(middle-&gt;left and left-&gt;right) </p>
                    </td>
                </tr>
                <tr class="TableStyle-StandardRules-Body-Body2">
                    <td class="TableStyle-StandardRules-BodyB-Column1-Body2">
                        <p class="Cell_Body">21</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyB-Column1-Body2">
                        <p class="Cell_Body">0.95</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyB-Column1-Body2">
                        <p class="Cell_Body">1.0</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyB-Column1-Body2">
                        <p class="Cell_Body">1.0</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyA-Column1-Body2">
                        <p class="Cell_Body">(no middle-&gt;right sampling)</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <p><span class="CodeLink"><a href="opcodes_mdmc.htm#opcodes_509685220_mdyn">MDYN</a></span>: Describes the dynamics simulation in which the free energy sampling is done. In this simple case we are only doing 100&#160;ps of mixed-mode simulation at each window. In real cases &gt; 500&#160;ps simulation per window will probably be required.</p>
        <p><span class="CodeLink"><a href="opcodes_flowcontrol.htm#opcodes_509685220_end">END</a></span>: The end of the <code>BGIN/END</code> loop. The loop terminates when the value of <span class="Symbol">l</span> (middle) exceeds 1.0. </p>
        <p><span class="CodeLink"><a href="opcodes_fep.htm#opcodes_509685220_fesu">FESU</a></span>: Prepare a summary of the free energy change during the simulation. </p>
        <table class="NavLink" data-mc-conditions="Default.ScreenOnly">
            <tr class="NavLink">
                <td class="NavLeft"><span class="NavText">◀ <a class="NavLink MCXref xref xrefNavLink" href="mm_free_energy_pert_setup_structure.htm">The Structure File for MacroModel FEP Calculations</a></span>
                </td>
                <td class="NavCenter"><span class="NavText"><a class="NavLink MCXref xref xrefNavLink" href="macromodel_command_referenceTOC.htm">MacroModel Command Reference Manual</a></span>
                </td>
                <td class="NavRight"><span class="NavText"><a class="NavLink MCXref xref xrefNavLink" href="mm_free_energy_pert_setup_other.htm">Other Possible Command Files for MacroModel FEP Calculations</a> ▶</span>
                </td>
            </tr>
        </table>
    </body>
</html>