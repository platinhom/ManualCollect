<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-US" xml:lang="en-US" data-mc-search-type="Stem" data-mc-help-system-file-name="Documentation.xml" data-mc-path-to-help-system="../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Command References|Canvas Command Reference|Running Canvas Applications from the Command Line|Similarity, Dissimilarity, and Clustering Programs">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" /><title>
            canvasLibOpt</title>
        <link href="../Resources/TableStyles/StandardRules.css" rel="stylesheet" data-mc-stylesheet-type="table" />
        <link href="../Resources/Stylesheets/docs.css" rel="stylesheet" />
        <script src="../Resources/Scripts/custom.modernizr.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/require.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/require.config.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/foundation.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/plugins.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/MadCapAll.js" type="text/javascript">
        </script>
    </head>
    <body><a name="aanchor291"></a>
        <MadCap:concept term="Command Reference" /><a name="aanchor292"></a>
        <MadCap:concept term="Canvas" /><a name="canvas_command_2298859567_canvaslibopt"><a name="canvas_command_2298859567_785677"></a></a><a name="canvas_command_2298859567_94057"></a>
        <table class="NavLink" data-mc-conditions="Default.ScreenOnly">
            <tr class="NavLink">
                <td class="NavLeft"><span class="NavText">◀ <a class="NavLink MCXref xref xrefNavLink" href="canvas_command_canvasDBCS.htm">
            canvasDBCS
</a></span>
                </td>
                <td class="NavCenter"><span class="NavText"><a class="NavLink MCXref xref xrefNavLink" href="canvas_command_referenceTOC.htm">Canvas Command Reference Manual</a></span>
                </td>
                <td class="NavRight"><span class="NavText"><a class="NavLink MCXref xref xrefNavLink" href="canvas_command_canvasFPHist.htm">
            canvasFPHist 
</a> ▶</span>
                </td>
            </tr>
        </table>
        <h1 class="Title">
            canvasLibOpt</h1>
        <p>This program selects a subset of compounds from a pool by minimizing their similarity, and optionally by optimizing the ranges of specified properties. It can be used to fill holes in an existing library of compounds. </p>
        <p>Given a pool of structures in a Canvas fingerprint file, <code>canvasLibOpt</code> uses a greedy, stochastic algorithm to select a diverse subset, with the goal of minimizing the sum of the average nearest neighbor Tanimoto similarity within the subset and the average property filter score, depending on which task is chosen.</p>
        <table class="TableStyle-StandardRules" style="caption-side: top;mc-table-style: url('../Resources/TableStyles/StandardRules.css');" cellspacing="0">
            <caption valign="top" style="padding-bottom: 7pt;">
                <p class="Table_Caption" data-mc-autonum="Table 1. "><span class="autonumber"><span>Table 1. </span></span>Description of columns in the CSV output file for canvasLibOpt</p>
            </caption>
            <thead>
                <tr class="TableStyle-StandardRules-Head-Header1">
                    <td class="TableStyle-StandardRules-HeadE-Column1-Header1">
                        <p class="Cell_Heading">Column</p>
                    </td>
                    <td class="TableStyle-StandardRules-HeadD-Column1-Header1">
                        <p class="Cell_Heading">Description</p>
                    </td>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-StandardRules-Body-Body1">
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body1">
                        <p class="Cell_Body">SMILES</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyG-Column1-Body1">
                        <p class="Cell_Body">SMILES string for the structure. If <i class="UserReplace">fpIn</i> does not contains a SMILES property, a dummy SMILES “C” is written to each row.</p>
                    </td>
                </tr>
                <tr class="TableStyle-StandardRules-Body-Body1">
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body1">
                        <p class="Cell_Body">Name</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyD-Column1-Body1">
                        <p class="Cell_Body">Name or ID of the structure.</p>
                    </td>
                </tr>
                <tr class="TableStyle-StandardRules-Body-Body2">
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body2">
                        <p class="Cell_Body">Row</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyG-Column1-Body2">
                        <p class="Cell_Body">Row number of the structure in <i class="UserReplace">fpIn</i>.</p>
                    </td>
                </tr>
                <tr class="TableStyle-StandardRules-Body-Body2">
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body2">
                        <p class="Cell_Body">Sim_NN</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyD-Column1-Body2">
                        <p class="Cell_Body">Tanimoto similarity to nearest neighbor in the optimized library.</p>
                    </td>
                </tr>
                <tr class="TableStyle-StandardRules-Body-Body1">
                    <td class="TableStyle-StandardRules-BodyH-Column1-Body1">
                        <p class="Cell_Body">Row_NN</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyG-Column1-Body1">
                        <p class="Cell_Body">Nearest neighbor row number.</p>
                    </td>
                </tr>
                <tr class="TableStyle-StandardRules-Body-Body1">
                    <td class="TableStyle-StandardRules-BodyE-Column1-Body1">
                        <p class="Cell_Body">Hole_NN </p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyD-Column1-Body1">
                        <p class="Cell_Body">Indicator or whether the nearest neighbor is in the original library (with holes). The value is 1 if it is in the original library, 0 otherwise.</p>
                    </td>
                </tr>
                <tr class="TableStyle-StandardRules-Body-Body2">
                    <td class="TableStyle-StandardRules-BodyB-Column1-Body2">
                        <p class="Cell_Body">Filter</p>
                    </td>
                    <td class="TableStyle-StandardRules-BodyA-Column1-Body2">
                        <p class="Cell_Body">Number of property filters failed by this structure divided by the total number of property filters. Set to 0 if no filters are used.</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <p>If hole-filling was chosen, the nearest neighbor to a given structure is determined by considering both the structures in the subset and the structures in the library (fingerprint file <i class="UserReplace">fpHoles</i>).If property filtering was chosen, the optimization attempts to minimize the average number of property filters that failed within the subset. A property filter is simply a range of allowed values for the property. Failure means that the property value lies outside the specified range. The filter score for a structure is computed as the number of failures divided by the total number of filters, i.e. the fraction of failures. The average filter score is the average of the filter scores for all structures in the subset.</p>
        <p>The total score is the average nearest neighbor similarity plus the average filter score. Both of these quantities lie on the interval [0, 1], so the total score lies on the interval [0, 2].</p>
        <p>Optimization is done by choosing the requested number of structures (<i class="UserReplace">nstr</i>) at random, then performing a series of optimization cycles that attempt to improve both the average nearest neighbor similarity and the average filter score.</p>
        <p>Each optimization cycle consists of making <i class="UserReplace">nstr</i> passes through the subset, with an attempt to replace the poorest scoring structure at each pass. The poorest scoring structure is the one that has the highest nearest neighbor similarity. If there are ties in the nearest neighbor similarity, the filter score is used to break the tie. A candidate structure is chosen at random as a possible replacement, and the replacement is done if doing so improves the total score for the subset. The total score is considered to improve if one of the following happens:</p>
        <ul class="ListCompact">
            <li value="1">Average nearest neighbor similarity and average filter score decrease.
    </li>
            <li value="2">Average nearest neighbor similarity decreases and average filter score remains the same.
    </li>
            <li value="3">Average nearest neighbor similarity remains the same and average filter score decreases.
    </li>
        </ul>
        <p>If the total score does not improve, a Monte Carlo test is used:</p><pre>
etest = deltaSim + deltaFilter
</pre>
        <p>where <code>deltaSim</code> is the increase in average nearest neighbor similarity, and <code>deltaFilter</code> is the increase in average filter score, both of which are greater than or equal to 0 if the score does not improve. The replacement is done if the probability, defined by </p><pre>
prob = exp(-etest/temperature)
</pre>
        <p>is greater than a random number between 0 and 1.</p>
        <p>The temperature decreases linearly over the course of the optimization, and the cooling schedule is chosen such that an <code>etest</code> value of 0.001 will yield <code>prob</code> = 0.5 in the first cycle, and <code>prob</code> = 0.01 in the last cycle. The default <code>etest</code> tolerance of 0.001 can be overridden using the option <code>-mc </code><i class="UserReplace">tol</i>.</p>
        <p>When the optimization has completed the requested number of cycles, or when other criteria are met, a CSV file is written with the optimized subset of structures. A SMILES column is included, so the CSV file can be imported into the Canvas GUI. The SMILES corresponds to the actual structure if the fingerprint file contains a SMILES property, which is always the case if the fingerprint file is exported from the GUI. And in that case, the Canvas UID is also included in the CSV file, so it is possible to read it back into the same project and update on Canvas UID. If there is no SMILES in the fingerprint file a dummy SMILES <code>"C"</code> is written for each structure.</p>
        <table class="NavLink" data-mc-conditions="Default.ScreenOnly">
            <tr class="NavLink">
                <td class="NavLeft"><span class="NavText">◀ <a class="NavLink MCXref xref xrefNavLink" href="canvas_command_canvasDBCS.htm">
            canvasDBCS
</a></span>
                </td>
                <td class="NavCenter"><span class="NavText"><a class="NavLink MCXref xref xrefNavLink" href="canvas_command_referenceTOC.htm">Canvas Command Reference Manual</a></span>
                </td>
                <td class="NavRight"><span class="NavText"><a class="NavLink MCXref xref xrefNavLink" href="canvas_command_canvasFPHist.htm">
            canvasFPHist 
</a> ▶</span>
                </td>
            </tr>
        </table>
    </body>
</html>