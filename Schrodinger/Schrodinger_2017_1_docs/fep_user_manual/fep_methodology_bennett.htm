<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-US" xml:lang="en-US" data-mc-search-type="Stem" data-mc-help-system-file-name="Documentation.xml" data-mc-path-to-help-system="../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="User Manuals|FEP+ User Manual|FEP+ Methodology">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" /><title>FEP Theory</title>
        <link href="../Resources/Stylesheets/docs.css" rel="stylesheet" />
        <script src="../Resources/Scripts/custom.modernizr.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/require.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/require.config.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/foundation.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/plugins.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/MadCapAll.js" type="text/javascript">
        </script>
    </head>
    <body><a name="aanchor7008"></a>
        <MadCap:concept term="User Manuals" /><a name="aanchor7009"></a>
        <MadCap:concept term="FEP+" />
        <table class="NavLink" data-mc-conditions="Default.ScreenOnly">
            <tr class="NavLink">
                <td class="NavLeft"><span class="NavText">◀ <a href="fep_methodology_theory.htm" class="NavLink MCXref xref xrefNavLink" xrefformat="{paratext}">FEP Basic Theory Overview</a></span>
                </td>
                <td class="NavCenter"><span class="NavText"><a class="NavLink MCXref xref xrefNavLink" href="fep_user_manualTOC.htm" xrefformat="{paratext}">FEP+ User Manual</a></span>
                </td>
                <td class="NavRight"><span class="NavText"><a href="fep_methodology_cycle_closure.htm" class="NavLink MCXref xref xrefNavLink" xrefformat="{paratext}">FEP Cycle Closure Method and Error Estimates</a> ▶</span>
                </td>
            </tr>
        </table>
        <h1>Bennett Acceptance Ratio Method and Error Estimates</h1>
        <p>When simulations are done for both the initial state corresponding to potential energy <i>U</i><sub>0</sub>(<i>x</i>, and the final state corresponding to the potential energy <i>U</i><sub>1</sub>(<i>x</i>), the two formulas in provide two different estimates of the free energy difference between the two systems. </p>
        <p>The Bennett Acceptance Ratio (BAR) method <a href="fep_references.htm#BAR" class="Reference_Number MCXref xref xrefReference_Number" xrefformat="[{color #0E6895}{paranumonly}{/color}]">[<span style="color: #0e6895;" class="mcFormatColor">8</span>]</a> works in a different way. It creates an imaginary intermediate state with potential energy <i>U</i>*(<i>x</i>), calculates the free energy difference between <i>U</i><sub>0</sub>(<i>x</i>) and <i>U</i><sub>*</sub>(<i>x</i>) using the data sampled from <i>U</i><sub>0</sub>(<i>x</i>), calculates the free energy difference between <i>U</i><sub>1</sub>(<i>x</i>) and <i>U</i><sub>*</sub>(<i>x</i>) using the data sampled from <i>U</i><sub>1</sub>(<i>x</i>), and then the sum of these  two free energy differences gives the free energy difference between the two systems. </p>
        <p>
            <img src="../GeneratedImages/Equations/Equation40.svg" alt="" class="_MCEquation_0 mcReset" />
        </p>
        <p>
            <img src="../Resources/Images/fep/bar_method.png" />
        </p>
        <p>Bennett figured out the optimal potential for the imaginary intermediate state
which minimizes the variance of the calculated free energy. The Bennett acceptance
ratio method works by solving the following two equations through iteration:</p>
        <p>
            <img src="../GeneratedImages/Equations/Equation41.svg" alt="" class="_MCEquation_0 mcReset" />
        </p>
        <p>
            <img src="../GeneratedImages/Equations/Equation42.svg" alt="" class="_MCEquation_0 mcReset" />
        </p>
        <p>where <i>N</i><sub>0</sub> and <i>N</i><sub>1</sub> are the number of data points sampled from <i>U</i><sub>0</sub>and <i>U</i><sub>1</sub>, </p>
        <p>
            <img src="../GeneratedImages/Equations/Equation43.svg" alt="" class="_MCEquation_0 mcReset" />
        </p>
        <p>is the Fermi function, and </p>
        <p>
            <img src="../GeneratedImages/Equations/Equation44.svg" alt="" class="_MCEquation_0 mcReset" />
        </p>
        <p>The free energy difference between a pair of ligands that are directly connected in the FEP mapper graph is estimated using the above BAR method, and is called <span class="Keyword">ddG_Ben</span>. </p>
        <p>The statistical uncertainty of the BAR free energy can be estimated through the delta method:</p>
        <p>
            <img src="../GeneratedImages/Equations/Equation45.svg" alt="" class="_MCEquation_0 mcReset" />
        </p>
        <p>which gives the following formula to calculate the analytical error of the BAR free
energy,</p>
        <p>
            <img src="../GeneratedImages/Equations/Equation46.svg" alt="" class="_MCEquation_0 mcReset" />
        </p>
        <p>The error for the BAR estimated free energy difference between two ligands calculated using the above formula is called <span class="Keyword">Error_Ben</span>.</p>
        <p>Another way to estimate the error of the BAR free energy is through bootstrapping. Bootstrapping works in the following way: randomly select <i>N</i><sub>0</sub> data points from the whole data sampled from <i>U</i><sub>0</sub> (allowing the same data point to be repeated multiple times), and <i>N</i><sub>1</sub> data points from the whole data sampled from <i>U</i><sub>1</sub>(allowing the same data point to be repeated multiple times), and calculate the BAR free energy using the regenerated data points. Repeat this process many times and calculate the variance of the calculated BAR free energy, which gives the bootstrapping estimated error of the BAR free energy, <span class="Keyword">Error_Bar_bootstrapping</span>. This error is reported in the result file for each leg of individual perturbations, but not in the final result file in the FEP Mapper output.</p>
        <p>In almost all the cases, the <span class="Keyword">Error_Ben</span> underestimates the real error in the calculated free energy.</p>
        <table class="NavLink" data-mc-conditions="Default.ScreenOnly">
            <tr class="NavLink">
                <td class="NavLeft"><span class="NavText">◀ <a href="fep_methodology_theory.htm" class="NavLink MCXref xref xrefNavLink" xrefformat="{paratext}">FEP Basic Theory Overview</a></span>
                </td>
                <td class="NavCenter"><span class="NavText"><a class="NavLink MCXref xref xrefNavLink" href="fep_user_manualTOC.htm" xrefformat="{paratext}">FEP+ User Manual</a></span>
                </td>
                <td class="NavRight"><span class="NavText"><a href="fep_methodology_cycle_closure.htm" class="NavLink MCXref xref xrefNavLink" xrefformat="{paratext}">FEP Cycle Closure Method and Error Estimates</a> ▶</span>
                </td>
            </tr>
        </table>
    </body>
</html>