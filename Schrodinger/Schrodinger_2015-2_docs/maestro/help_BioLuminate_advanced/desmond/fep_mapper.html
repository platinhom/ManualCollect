<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<link rel="stylesheet" href="../support/help.css" charset="ISO-8859-1" type="text/css" />
<title>FEP Mapper Panel</title>
</head>
<body>
<table bgcolor="#dcdcdc" border="0" cellspacing="0" width="100%">
<tr><td>
<p><img src="../images/common/schrodinger_logo.png" align="left" alt=""
 border="0" hspace="5" vspace="5" /></p>
</td></tr>
<tr><td>
<h1 class="title">FEP Mapper Panel</h1>
</td></tr>
</table>

<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#opening">Opening the <span class="GUI">FEP Mapper</span> Panel</a></li>
<li><a href="#using">Using the <span class="GUI">FEP Mapper</span> Panel</a></li>
<li><a href="#features"><span class="GUI">FEP Mapper</span> Panel Features</a></li>
<li><a href="#links">Related Topics</a></li>
</ul>

<a name="summary"></a>
<h2>Summary</h2>

<p>Build a perturbation scheme for FEP calculations on a set of congeneric
ligands, and run the job to perform the calculations of the relative binding
free energy. 
</p>

<a name="opening"></a>
<h2>Opening the FEP Mapper Panel</h2>

<p>To open the <span class="GUI">FEP Mapper</span> panel, you can:</p>
<ul>
<li><p>Choose <span class="GUI">Tasks &rarr; Advanced Tasks &rarr; Free Energy Perturbation &rarr; FEP Mapper</span> 
in the main window.
</p></li>
</ul>


<a name="using"></a> 
<h2>Using the FEP Mapper Panel</h2> 


<p>For a tutorial exercise in using this panel, see 
<a href="fep_mapper_tutorial.html">FEP Mapper Tutorial</a>.</p>

<p><b>To import ligands and a receptor</b>, do one of the following:</p>
<ul>
<li><p>Select the receptor and the desired ligands in the Project Table, then
click <span class="GUI">Project Table</span> for <span class="GUI">Import
from</span> in the <span class="GUI">FEP Mapper</span> panel.
</p></li>
<li><p>Click <span class="GUI">File</span> for <span class="GUI">Import
from</span> and select a Maestro file that contains the receptor and the ligands
(such as a pose viewer file, <code>_pv.maegz</code>).
</p></li>
</ul>

<p><b>To set up a new perturbation scheme:</b>
</p>
<ol>
<li><p>Open the <span class="GUI">FEP Mapper</span> panel.
</p></li>
<li><p>Import the receptor and the desired ligands as described above.
</p>
<p>The title of the receptor entry is displayed below the <span
class="GUI">Import from</span> buttons. The ligands are added to the table,
and represented in the graph area, without connections.
</p></li>
<li><p>Check the box in the <span class="GUI">Bias</span> column for any ligand
you want to emphasize when the graph is built. </p>
<p>The bias boosts the similarity between ligands, which is used to determine
whether to connect two ligands.
</p></li>
<li><p>(Optional) Enter the binding affinity for any ligand you want to
emphasize when the graph is built.</p>
<p>The similarity is boosted by a fixed amount for any ligand whose binding
affinity is specified. The affinity is also used in the analysis of the FEP 
results in the <a href="fep_mapper_analysis.html"><span class="GUI">FEP Mapper
Analysis</span> panel</a>.
</p>
<p>You can use a Maestro property for the binding affinity by
right-clicking the heading of the <span class="GUI">Affinity</span> column and
choosing<span class="GUI"> Import from structure property</span>, then choosing
the property in the dialog box that opens. The units that the affinity is given
in can also be selected in this dialog box; the affinity is then converted to
kcal/mol. You can also set the affinity for any ligand by editing the table cell.
</p></li>
<li><p>Click <span class="GUI">Create Graph</span>.</p>
<p>A dialog box is displayed, indicating that the construction of the
perturbation scheme is in progress. When this task finishes, the perturbation
scheme is displayed in the panel.
</p></li>
</ol>

<p>The diagram consists of 2D ligand structures in boxes, connected by
lines. The lines represent allowed perturbations. You can select ligands and
connections by clicking on them, or dragging over them. You can add or
remove ligands or connections from the selection with control-click. The
selected objects are highlighted in yellow.
</p>

<p><b>To rearrange the layout:</b></p>

<ul>
<li>Drag a ligand box to reposition it.</li>
<li>Drag over several ligand boxes, then drag them to reposition the group.</li>
<li>Drag with the right mouse button to move the entire diagram.</li>
<li>Use the mouse wheel to zoom in or out.</li>
</ul>

<p><b>To highlight particular perturbations:</b>
</p>
<ul>
<li>Pause the pointer over a ligand. The ligands to which it is not
directly connected, with their connections, are dimmed. </li>
</ul>

<p><b>To delete ligands or connections from the diagram:</b>
</p>
<ol>
<li>Select the ligands and connections.
</li>
<li><p>Click the <span class="GUI">Delete</span> button.
</p>
<img src="../images/desmond/delete.png" />
</li>
</ol>

<p><b>To add ligands or connections to the diagram:</b>
</p>
<ol>
<li><p>Click the <span class="GUI">Add</span> button.
</p>
<img src="../images/desmond/new_connection.png" />
</li>
<li>Select the ligands and connections.
</li>
</ol>

<p><b>To submit a job</b> for the relative binding free energy using the
perturbation scheme, you can use the Job toolbar. If you have not entered
affinity data for the ligands, a warning is displayed. If you do not want to see
the warning in future, you can select an option to suppress it in the warning
dialog box.
</p>
<p>To submit a job from the command line, use the <code>fep_plus</code>
command. Use the <code>-h</code> option to get help on using the command.
</p>

<p><b>To restart a job</b> use the following command:</p>
<p><code>fep_plus -RESTART <i>checkpoint-file</i> -HOST <i>master-host</i> -SUBHOST <i>subjob-host</i> -JOBNAME <i>jobname</i></code>
</p>
<p>The restarted job runs the previously failed connections. No data is kept
from the failed connections, which are rerun from the beginning.
</p>


<a name="features"></a> 
<h2>FEP Mapper Panel Features</h2> 


<ul>
<li><a href="#feature0"><span class="GUI">Import from</span> buttons</a></li>
<li><a href="#ligands">Ligands table</a></li>
<li><a href="#feature2"><span class="GUI">Generate Map</span> button</a></li>
<li><a href="#feature3">Toolbar</a></li>
<li><a href="#feature4">Perturbation scheme diagram</a></li>
<li><a href="#job_toolbar">Job toolbar</a></li>
<li><a href="#status_bar">Status bar</a></li>
</ul>

<dl>

<a name="feature0"></a>
<dt><span class="GUI">Import from</span> buttons</dt>
<dd><p>Use these buttons to import the receptor and ligands or to import an
existing perturbation scheme, which contains the receptor and ligands. The
receptor and ligands must be imported together; you cannot do multiple imports
to add a receptor or ligands.</p>
<ul>
<li><p><span class="GUI">Project Table</span>&mdash;Import the receptor and
ligands from the selected entries in the Project Table.
</p></li>
<li><p><span class="GUI">File</span>&mdash;Import the receptor and the ligands
from a Maestro file, or import a perturbation scheme, which includes the
receptor, ligands, and graph data, from a file. Opens a file selector in which
you can choose the file type, navigate to and open the file. Perturbation scheme
files have the extension <code>.pkl</code> or <code>_fep.map</code>. 
</p></li>
</ul>
<p>When the structures are imported, the ligands are listed in the table
below. The title of the receptor entry is displayed below the buttons. If a
perturbation scheme is imported, it is displayed. Any ligands from the previous
scheme that are displayed in the Workspace are removed from the Workspace, but
any other structures that are in the Workspace remain in the Workspace.
</p>
</dd>

<a name="ligands"></a>
<dt>Ligands table</dt>
<dd><p>This table lists the ligands that you imported from the Project Table.
The table columns are described below.</p>
<ul>
<li><span class="GUI">Title</span>&mdash;Title of the ligand, from the Project
Table. </li>
<li><span class="GUI">Status</span>&mdash;Provides information on the suitability
of the ligand for FEP calculations. <span class="GUI">OK</span> indicates that
the ligand passes all the tests; <span class="GUI">X</span> indicates that the
ligand failed some tests. The tests that it failed are listed in the tooltip.</li>
<li><span class="GUI">Bias</span>&mdash;Column of check boxes that can be use to
bias the graph construction to draw more connections to the ligand. The biasing
is done by boosting the calculated similarity to other ligands. If you change
the bias settings, you must click <span class="GUI">Generate Map</span> to
generate a graph with the new settings.</li>
<li><span class="GUI">Affinity</span>&mdash;Binding affinity of the ligand. Any
ligand whose binding affinity you enter is favored in the construction of the
graph, by adding a further bias to the similarity. 
The affinity is also used in the analysis of the FEP results in
the <a href="fep_mapper_analysis.html"><span class="GUI">FEP Mapper 
Analysis</span> panel</a>. You can choose a Maestro
property for the affinity by right-clicking in the column heading and choosing
<span class="GUI">Import from structure property</span>, then choosing a
property in the dialog box that opens. The units that the affinity is given
in can also be selected in this dialog box; the affinity is then converted to
kcal/mol. You can also edit individual cells to set
or change the affinity.
</li>
</ul>
</dd>

<a name="feature2"></a>
<dt><span class="GUI">Generate Map</span> button</dt>
<dd><p>Create the perturbation scheme from the ligands in the table. The ligand
structures are analyzed to find possible perturbations between them. This may
take a few minutes, depending on the number of ligands. A progress dialog box is
displayed while the analysis is running. When the analysis finishes, the diagram
showing the possible perturbations is displayed.</p>
<p>The graph is constructed by determining the maximum common substructure
between the ligands (using Canvas MCS with special atom types for FEP), and
calculating the similarity. Connections are made between structures with high
similarity. The similarity between one ligand and the rest can be boosted by
setting the affinity or selecting the <span class="GUI">Bias</span> option for
that ligand in the ligands table.</p>
<p>Once you generate a graph, the button text changes to <span class="GUI">Map
Generated</span> and the button is deactivated. When you edit the graph or make
changes in the ligands table, the button text changes back
to <span class="GUI">Generate Map</span> and the button is reactivated.
You can then click the button to create a new graph, for example with a
different bias.
</p></dd>

<a name="feature3"></a>
<dt>Toolbar</dt>
<dd><p>The toolbar has the following buttons: 
</p>

<table>
<tr>
<td><img src="../images/desmond/undo_grayscale.png" /></td>
<td><span class="GUI">Undo</span><br />
Undo changes to the perturbation scheme. You can undo multiple changes.
</td> 
</tr>
<tr>
<td><img src="../images/desmond/redo_grayscale.png" /></td>
<td><span class="GUI">Redo</span><br />
Redo changes to the perturbation scheme. You can redo multiple undone changes.
</td> 
</tr>
<tr>
<td><img src="../images/desmond/network_grayscale.png" height=25 width=25 /></td>
<td><span class="GUI">Auto-layout</span><br />
Automatically optimize the layout of the graph in the panel.
</td> 
</tr>
<tr>
<td><img src="../images/desmond/plus_grayscale.png" /></td>
<td><span class="GUI">Add new connection</span><br />
Add a connection between two ligands in the perturbation diagram. Click this
button, then click the ligands to add the connection.
</td> 
</tr>
<tr>
<td><img src="../images/desmond/minus_grayscale.png" /></td>
<td><span class="GUI">Delete</span><br />
Delete the selected ligands and connections from the perturbation scheme. 
</td> 
</tr>
</table>

</dd>

<a name="feature4"></a>
<dt>Perturbation scheme diagram</dt>
<dd><p>The diagram consists of 2D ligand structures in boxes, connected by
lines. The lines represent allowed perturbations. You can select ligands and
connections by clicking on them, or dragging over them. You can add ligands or
connections to the selection, or remove them from the selection, with
control-click. The selected objects are highlighted in yellow. Selected ligands
are included in the Workspace.</p>
<p>You can show similarity scores for the connected ligands next to the
connections by selecting <span class="GUI">Show similarity scores</span>. The
scores are updated as changes are made to the map.  
</p></dd>

<a name="job_toolbar"></a>
<dt>Job toolbar</dt>
<dd><p>The Job toolbar is used to make settings for a job and to start it. </p>

<dl>
<dt><span class="GUI">Job name</span> text box</dt>
<dd><p>Enter a name for the job in this text box.
</p></dd>
<dt><span class="GUI">Settings</span> button menu</dt>
<dd><p>This button opens the <a href="../misc/job_settings.html"><span
class="GUI">Job Settings</span> dialog box</a>. The arrow to the right opens
a menu, from which you can make settings or perform actions that are related to
the job. </p>
<img src="../images/MaestroToolbarIcons/settings.png" />
<p>The menu items are described below.</p>
<ul>
<li><span class="GUI">Job Settings</span>&mdash;Make and save settings for the
incorporation of the job into the Maestro project, the job name, the host,
the distribution of subjobs, and any other application-specific job settings.
Opens the <span class="GUI">Job Settings</span> dialog box.</li>
<li><span class="GUI">Preferences</span>&mdash;Set general preferences for
running jobs. Opens the <span class="GUI">Preferences</span> panel at the <a
href="../maestro_menu/preferences.html#jobs_starting"><span class="GUI">Jobs - 
Starting</span> section</a>.</li>
<li><span class="GUI">Write</span>&mdash;Write the input files for the job but do not start it. 
The file names are based on the current job name, and the files are written to
a subdirectory of the current working directory that is named with the job
name.</li>
<li><p><span class="GUI">Export Map</span>&mdash;Export the perturbation map to
a map file. You can import this file into the panel later on.
</p></li>
<li><p><span class="GUI">Export Map as PDF</span>&mdash;Export the map image to
a PDF file. 
</p></li>
</ul>
</dd>

<dt><span class="GUI">Job status</span> button</dt>
<dd><p>This icon indicates when there are jobs running for the application that
belong to the current project. It starts spinning when the first job starts, and
stops when there are no more jobs running. If a job fails to start, it changes
to an exclamation point. 
</p>
<img src="../images/MaestroToolbarIcons/job_status.png" />
<p>
Clicking the button shows a small job status window that lists the job name and
status for all active jobs submitted from the current panel (for Jaguar and
MacroModel this means all jobs from any of the application panels). You can
double-click on a row to open the <a href="../misc/monitor_panel.html"><span
class="GUI">Monitor</span> panel</a> and monitor the job, or click the <span
class="GUI">Monitor</span> button to open the <span class="GUI">Monitor</span>
panel and close the job status window. The job status is updated while the
window is open. If a job finishes while the window is open, the job remains
displayed but with the new status.  The rows are colored according to the
status: yellow for submitted, green for launched, running, or finished, red for
incorporated, died, or killed.  Click anywhere outside the window to close it.
</p></dd>

<dt><span class="GUI">Run</span> button</dt>
<dd><p>Run the job with the current job settings.
</p></dd>
</dl>
</dd>


<a name="status_bar"></a>
<dt>Status bar</dt>
<dd><p>The status bar displays information about the current job settings for the
panel. This includes the job name, task name and task settings (if any), number
of subjobs (if any) and the host name and job incorporation setting. It also
displays a message for a short time when you start a new job.</p>
<p>The status bar also contains the <span class="GUI">Help</span> button, which
opens the help topic for the panel.</p>
<img src="../images/MaestroToolbarIcons/help.png" />
</dd>

</dl>

<a name="links"></a>
<h2>Related Topics</h2>
<ul>
<li><a href="fep_mapper_analysis.html">FEP Mapper Analysis Panel</a></li>

<li><a href="fep_mapper_tutorial.html">FEP Mapper Tutorial</a></li>
<li><a href="fep_mapper_umbrella.html">Running FEP Mapper jobs in umbrella mode</a></li>
</ul>
<hr />
<table width="100%">
<tr><td><p class="small"><a href="../support/legal_notice.html" target="LegalNoticeWindow">Legal Notice</a></p></td>
<td>
<table align="right">
<tr><td><p class="small">
File: desmond/fep_mapper.html<br />
Last updated: 13 Mar 2015
</p></td></tr>
</table>
</td></tr>
</table>
</body>
</html>
